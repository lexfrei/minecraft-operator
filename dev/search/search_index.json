{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Minecraft Operator","text":"<p>Kubernetes operator for managing PaperMC servers with automatic version management for plugins and the server, ensuring compatibility through constraint solving.</p>"},{"location":"#features","title":"Features","text":"<ul> <li>Automatic Version Management \u2014 Four update strategies: <code>latest</code>, <code>auto</code>, <code>pin</code>, <code>build-pin</code></li> <li>Plugin Compatibility Solver \u2014 Constraint solver ensures plugins work with selected Paper version</li> <li>Scheduled Updates \u2014 Cron-based maintenance windows with graceful RCON shutdown</li> <li>Declarative Plugin Management \u2014 Plugins are matched to servers via label selectors</li> <li>Web UI \u2014 Built-in dashboard for monitoring servers and plugins</li> <li>Hangar Integration \u2014 Automatic plugin downloads from PaperMC Hangar</li> </ul> <p>Not a High-Availability System</p> <p>This operator is designed for single-instance Minecraft servers. 5-10 minutes of downtime during updates is acceptable by design.</p>"},{"location":"#quick-start","title":"Quick Start","text":"<pre><code># Single step \u2014 CRDs are embedded and applied at startup via server-side apply\nhelm install minecraft-operator \\\n  oci://ghcr.io/lexfrei/minecraft-operator \\\n  --namespace minecraft-operator-system \\\n  --create-namespace\n</code></pre> <p>See Getting Started for detailed setup instructions.</p>"},{"location":"#documentation-sections","title":"Documentation Sections","text":"<ul> <li> <p> Getting Started</p> <p>Prerequisites, installation, and your first Minecraft server</p> <p> Get started</p> </li> <li> <p> Configuration</p> <p>CRD reference for PaperMCServer, Plugin, and update strategies</p> <p> Configure</p> </li> <li> <p> Architecture</p> <p>System design, constraint solver, and update workflow</p> <p> Learn more</p> </li> <li> <p> Operations</p> <p>Troubleshooting, monitoring, and maintenance</p> <p> Operate</p> </li> <li> <p> Development</p> <p>Development setup, testing, and contributing</p> <p> Develop</p> </li> <li> <p> Reference</p> <p>Helm chart values, API reference, and more</p> <p> Reference</p> </li> </ul>"},{"location":"#project-links","title":"Project Links","text":"<ul> <li>GitHub Repository</li> <li>Issues</li> <li>Releases</li> </ul>"},{"location":"#license","title":"License","text":"<p>BSD 3-Clause License - see LICENSE for details.</p>"},{"location":"architecture/","title":"Architecture","text":"<p>This section covers the internal architecture of Minecraft Operator.</p>"},{"location":"architecture/#overview","title":"Overview","text":"<p>The operator consists of three main controllers that work together:</p> <pre><code>graph TB\n    subgraph \"Custom Resources\"\n        Plugin[Plugin CRD]\n        Server[PaperMCServer CRD]\n    end\n\n    subgraph \"Controllers\"\n        PC[Plugin Controller]\n        SC[PaperMCServer Controller]\n        UC[Update Controller]\n    end\n\n    subgraph \"External APIs\"\n        Hangar[Hangar API]\n        Docker[Docker Hub]\n    end\n\n    subgraph \"Kubernetes Resources\"\n        STS[StatefulSet]\n        SVC[Service]\n        PVC[PersistentVolumeClaim]\n    end\n\n    Plugin --&gt; PC\n    Server --&gt; SC\n\n    PC --&gt; Hangar\n    PC --&gt; Server\n\n    SC --&gt; Docker\n    SC --&gt; STS\n    SC --&gt; SVC\n    SC --&gt; PVC\n\n    UC --&gt; Server\n    UC --&gt; STS</code></pre>"},{"location":"architecture/#controllers","title":"Controllers","text":"Controller Responsibility Plugin Controller Fetches plugin metadata, runs compatibility solver PaperMCServer Controller Manages StatefulSet, Service, resolves versions Update Controller Executes scheduled updates with graceful shutdown"},{"location":"architecture/#sections","title":"Sections","text":"<ul> <li> <p> Design</p> <p>Complete system architecture and design decisions</p> <p> Design</p> </li> <li> <p> Constraint Solver</p> <p>How version compatibility is resolved</p> <p> Solver</p> </li> <li> <p> Dependencies</p> <p>External libraries, container images, and APIs</p> <p> Dependencies</p> </li> </ul>"},{"location":"architecture/#key-design-principles","title":"Key Design Principles","text":""},{"location":"architecture/#not-high-availability","title":"Not High-Availability","text":"<p>This operator is designed for single-instance Minecraft servers. 5-10 minutes of downtime during updates is acceptable by design.</p>"},{"location":"architecture/#declarative-plugin-management","title":"Declarative Plugin Management","text":"<p>Plugins are matched to servers via label selectors, enabling:</p> <ul> <li>Many-to-many relationships between plugins and servers</li> <li>Centralized plugin management across multiple servers</li> <li>Automatic version resolution per server</li> </ul>"},{"location":"architecture/#constraint-solving","title":"Constraint Solving","text":"<p>The operator uses a constraint solver to find compatible versions:</p> <ul> <li>For Plugins: Find maximum plugin version compatible with ALL matched servers</li> <li>For Servers: Find maximum Paper version compatible with ALL matched plugins</li> </ul>"},{"location":"architecture/#graceful-updates","title":"Graceful Updates","text":"<p>Updates are applied safely:</p> <ol> <li>RCON <code>save-all</code> command saves world data</li> <li>RCON <code>stop</code> command gracefully stops the server</li> <li>Pod termination respects <code>terminationGracePeriodSeconds</code></li> <li>StatefulSet recreates the pod with new version</li> </ol>"},{"location":"architecture/#technology-stack","title":"Technology Stack","text":"Component Technology Framework controller-runtime v0.22+ Language Go 1.26+ Container distroless/static-debian12:nonroot Charts Helm 3.14+ API Group <code>mc.k8s.lex.la/v1beta1</code>"},{"location":"architecture/#next-steps","title":"Next Steps","text":"<ul> <li>Design \u2014 Detailed architecture documentation</li> <li>Constraint Solver \u2014 Version resolution algorithm</li> </ul>"},{"location":"architecture/dependencies/","title":"Dependencies","text":"<p>This project relies on several external components and libraries.</p>"},{"location":"architecture/dependencies/#container-image","title":"Container Image","text":""},{"location":"architecture/dependencies/#why-lexfreipapermc","title":"Why lexfrei/papermc?","text":"<p>The operator uses <code>lexfrei/papermc</code> \u2014 a minimal, predictable PaperMC image designed for Kubernetes.</p> <p>Key difference from itzg/docker-minecraft-server:</p> Aspect lexfrei/papermc itzg/docker-minecraft-server JAR location Baked into image at build time Downloaded at container startup Dockerfile ~40 lines, direct <code>java -jar</code> Hundreds of lines + scripts Scope Paper only Vanilla, Forge, Fabric, etc. Startup Instant (JAR already present) Network-dependent <p>Why this matters for the operator:</p> <ol> <li> <p>Predictable deployments \u2014 The JAR is part of the image, not downloaded at runtime. No network failures during pod startup.</p> </li> <li> <p>Simpler debugging \u2014 Direct Java execution, no wrapper scripts to troubleshoot.</p> </li> <li> <p>Version pinning \u2014 Tag <code>1.21.4-125</code> contains exactly that version. No <code>VERSION=LATEST</code> magic.</p> </li> <li> <p>Kubernetes-native \u2014 Runs as UID 9001 (non-root), includes socket-based health checks.</p> </li> </ol> <p>Source: github.com/lexfrei/papermc-docker</p>"},{"location":"architecture/dependencies/#image-tags","title":"Image Tags","text":"<p>Format: <code>lexfrei/papermc:{version}-{build}</code></p> <p>Examples:</p> <ul> <li><code>lexfrei/papermc:1.21.4-125</code></li> <li><code>lexfrei/papermc:1.20.6-148</code></li> </ul> <p>The operator resolves concrete tags based on <code>updateStrategy</code>:</p> Strategy Tag Resolution <code>latest</code> Newest version-build from Docker Hub <code>auto</code> Solver-picked compatible version-build <code>pin</code> Specified version, latest build <code>build-pin</code> Exact version-build"},{"location":"architecture/dependencies/#go-libraries","title":"Go Libraries","text":""},{"location":"architecture/dependencies/#go-hangar","title":"go-hangar","text":"<p>Client library for the PaperMC Hangar API.</p> <p>Repository: github.com/lexfrei/go-hangar</p> <p>Purpose: Fetches plugin metadata (versions, compatibility, download URLs) from hangar.papermc.io.</p> <p>Usage in operator:</p> <pre><code>import \"github.com/lexfrei/go-hangar/pkg/hangar\"\n\nclient := hangar.NewClient(hangar.Config{\n    BaseURL: hangar.DefaultBaseURL,\n    Timeout: hangar.DefaultTimeout,\n})\nversions, err := client.ListVersions(ctx, \"EssentialsX\", \"Essentials\", hangar.ListOptions{})\n</code></pre>"},{"location":"architecture/dependencies/#why-a-custom-client","title":"Why a custom client?","text":"<ol> <li>Type-safe API \u2014 Strongly typed responses for plugin metadata</li> <li>Pagination handling \u2014 Automatic handling of paginated results</li> <li>Rate limiting \u2014 Built-in rate limiting to respect API limits</li> <li>Caching-friendly \u2014 Response structures designed for caching</li> </ol>"},{"location":"architecture/dependencies/#external-apis","title":"External APIs","text":""},{"location":"architecture/dependencies/#hangar-api","title":"Hangar API","text":"<p>URL: <code>https://hangar.papermc.io/api/v1/</code></p> <p>Used for:</p> <ul> <li>Plugin metadata (versions, compatibility)</li> <li>Download URLs</li> <li>Release dates (for <code>updateDelay</code> calculation)</li> </ul> <p>Rate limits: Respected via client-side throttling</p>"},{"location":"architecture/dependencies/#docker-hub-registry-api","title":"Docker Hub Registry API","text":"<p>URL: <code>https://hub.docker.com/v2/</code></p> <p>Used for:</p> <ul> <li>Listing available Paper versions</li> <li>Getting image digests for version resolution</li> </ul>"},{"location":"architecture/dependencies/#kubernetes-dependencies","title":"Kubernetes Dependencies","text":"Dependency Version Purpose controller-runtime v0.22+ Operator framework client-go v0.34+ Kubernetes API client apimachinery v0.34+ API types and utilities"},{"location":"architecture/dependencies/#future-dependencies","title":"Future Dependencies","text":""},{"location":"architecture/dependencies/#modrinth-api-planned","title":"Modrinth API (Planned)","text":"<p>URL: <code>https://api.modrinth.com/v2/</code></p> <p>Status: Not yet implemented (see #2)</p>"},{"location":"architecture/dependencies/#spigotmc-api-planned","title":"SpigotMC API (Planned)","text":"<p>Status: Not yet implemented (see #3)</p>"},{"location":"architecture/dependencies/#see-also","title":"See Also","text":"<ul> <li>Architecture \u2014 System design</li> <li>papermc-docker \u2014 Container image source</li> <li>go-hangar \u2014 Hangar API client</li> </ul>"},{"location":"architecture/design/","title":"Design","text":"<p>This document covers the system architecture and design decisions of Minecraft Operator.</p> <p>Full Design Document</p> <p>For the complete design document, see DESIGN.md in the repository.</p>"},{"location":"architecture/design/#goals","title":"Goals","text":"<ol> <li>Version Control \u2014 Automatic tracking of PaperMC server and plugin updates</li> <li>Compatibility Guarantee \u2014 Constraint solver finds newest compatible versions</li> <li>Predictable Updates \u2014 Updates only during defined maintenance windows</li> <li>Graceful Updates \u2014 Proper RCON shutdown before updates</li> </ol>"},{"location":"architecture/design/#non-goals","title":"Non-Goals","text":"<ul> <li>High Availability \u2014 5-10 minute downtime during updates is acceptable</li> <li>World backups (separate tooling)</li> <li>Update rollbacks (world format changes are destructive)</li> <li>Performance monitoring (TPS, lag)</li> <li>Horizontal scaling</li> <li>Zero-downtime updates</li> </ul>"},{"location":"architecture/design/#system-architecture","title":"System Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              K8s API Server                      \u2502\n\u2502                                                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502 Plugin CRD   \u2502       \u2502 PaperMCServer    \u2502   \u2502\n\u2502  \u2502              \u2502       \u2502 CRD              \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502            \u2502\n                 \u2502   Watch    \u2502\n                 \u2502            \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         Minecraft Operator                       \u2502\n\u2502                                                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502   Plugin Controller                      \u2502   \u2502\n\u2502  \u2502   - Match servers via selector           \u2502   \u2502\n\u2502  \u2502   - Fetch from plugin APIs               \u2502   \u2502\n\u2502  \u2502   - Run solver for all matched servers   \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502   PaperMCServer Controller               \u2502   \u2502\n\u2502  \u2502   - Find matched plugins                 \u2502   \u2502\n\u2502  \u2502   - Ensure StatefulSet exists            \u2502   \u2502\n\u2502  \u2502   - Run solver for Paper version         \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502   Update Controller                      \u2502   \u2502\n\u2502  \u2502   - Watch cron schedule                  \u2502   \u2502\n\u2502  \u2502   - Graceful shutdown via RCON           \u2502   \u2502\n\u2502  \u2502   - Update JARs and restart              \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502            \u2502\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n        \u2502                 \u2502   \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Plugin APIs \u2502  \u2502  Minecraft Pods   \u2502\n\u2502  - Hangar    \u2502  \u2502  + RCON           \u2502\n\u2502  - Modrinth  \u2502  \u2502  + StatefulSet    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/design/#component-interactions","title":"Component Interactions","text":""},{"location":"architecture/design/#plugin-papermcserver-declarative","title":"Plugin \u2192 PaperMCServer (Declarative)","text":"<ol> <li>Plugin defines <code>instanceSelector</code> labels</li> <li>Plugin Controller finds all matched servers</li> <li>Solver calculates best version for all matched servers</li> <li>PaperMCServer Controller reads resolved versions from Plugin.status</li> </ol>"},{"location":"architecture/design/#papermcserver-plugin-reactive","title":"PaperMCServer \u2192 Plugin (Reactive)","text":"<ol> <li>When labels change on PaperMCServer</li> <li>Plugin Controller recalculates matching</li> <li>May trigger new solver solution</li> </ol>"},{"location":"architecture/design/#update-flow","title":"Update Flow","text":"<ol> <li>Trigger: Cron in <code>PaperMCServer.spec.updateSchedule</code></li> <li>Update Controller coordinates:</li> <li>Reads resolved versions from all matched Plugins</li> <li>Reads <code>availableUpdate</code> from PaperMCServer.status</li> <li>Performs graceful shutdown via RCON</li> <li>Updates JARs in <code>plugins/update/</code> directory</li> <li>Deletes pod for StatefulSet recreation</li> </ol>"},{"location":"architecture/design/#controller-details","title":"Controller Details","text":""},{"location":"architecture/design/#plugin-controller","title":"Plugin Controller","text":"<p>Watches: Plugin CRDs</p> <p>Reconciliation loop:</p> <ol> <li>Fetch metadata from plugin repository (Hangar)</li> <li>Find all PaperMCServer instances matching <code>instanceSelector</code></li> <li>Run constraint solver to find best compatible version</li> <li>Update Plugin.status with resolved version and matched instances</li> <li>Trigger reconciliation on matched PaperMCServer resources</li> </ol>"},{"location":"architecture/design/#papermcserver-controller","title":"PaperMCServer Controller","text":"<p>Watches: PaperMCServer CRDs, matched Plugin CRDs</p> <p>Reconciliation loop:</p> <ol> <li>Ensure StatefulSet exists with correct configuration</li> <li>Ensure Service exists for server access</li> <li>Find all Plugin resources that match this server</li> <li>Based on <code>updateStrategy</code>:</li> <li><code>latest</code>: Query Docker Hub for newest version</li> <li><code>auto</code>: Run solver for plugin compatibility</li> <li><code>pin</code>/<code>build-pin</code>: Validate pinned version</li> <li>Update status with current/desired versions</li> </ol>"},{"location":"architecture/design/#update-controller","title":"Update Controller","text":"<p>Watches: PaperMCServer CRDs (cron-triggered)</p> <p>Update process:</p> <ol> <li>Check if maintenance window is active</li> <li>Check if update is available and <code>updateDelay</code> satisfied</li> <li>Download plugin JARs to <code>/data/plugins/update/</code></li> <li>Send RCON <code>save-all</code> command</li> <li>Send RCON <code>stop</code> command</li> <li>Wait for graceful shutdown</li> <li>Update StatefulSet image tag</li> <li>Delete pod \u2192 StatefulSet recreates with new version</li> </ol>"},{"location":"architecture/design/#resource-relationships","title":"Resource Relationships","text":"<pre><code>erDiagram\n    Plugin ||--|{ PaperMCServer : \"matches via selector\"\n    PaperMCServer ||--|| StatefulSet : \"creates\"\n    PaperMCServer ||--|| Service : \"creates\"\n    StatefulSet ||--|| Pod : \"manages\"\n    Pod ||--|| PVC : \"uses\"</code></pre>"},{"location":"architecture/design/#selector-conflict-resolution","title":"Selector Conflict Resolution","text":"<p>When multiple Plugins match the same server:</p> <ol> <li>If any has <code>updateStrategy: latest</code>: solver picks optimal version</li> <li>If all have <code>updateStrategy: pin</code>: highest semver wins (with warning)</li> </ol>"},{"location":"architecture/design/#version-resolution","title":"Version Resolution","text":""},{"location":"architecture/design/#paper-version-resolution","title":"Paper Version Resolution","text":"<p>Based on <code>updateStrategy</code>:</p> Strategy Resolution <code>latest</code> Newest from Docker Hub (ignores plugins) <code>auto</code> Solver finds compatible version <code>pin</code> Specified version, latest build <code>build-pin</code> Exact version and build"},{"location":"architecture/design/#plugin-version-resolution","title":"Plugin Version Resolution","text":"<p>Based on <code>updateStrategy</code>:</p> Strategy Resolution <code>latest</code> Newest compatible with ALL matched servers <code>auto</code> Solver picks optimal version <code>pin</code> Specified version <code>build-pin</code> Exact version and build"},{"location":"architecture/design/#edge-cases","title":"Edge Cases","text":""},{"location":"architecture/design/#repository-unavailable","title":"Repository Unavailable","text":"<ul> <li>Use cached <code>status.availableVersions</code></li> <li>Mark <code>repositoryStatus: orphaned</code></li> <li>Log warning</li> </ul>"},{"location":"architecture/design/#plugin-without-version-metadata","title":"Plugin Without Version Metadata","text":"<ul> <li>Assume compatibility with warning</li> <li>Use <code>compatibilityOverride</code> if set</li> </ul>"},{"location":"architecture/design/#no-compatible-version-found","title":"No Compatible Version Found","text":"<ul> <li>Emit warning in Plugin.status conditions</li> <li>Keep current version installed</li> <li>Set <code>updateBlocked: true</code> on server</li> </ul>"},{"location":"architecture/design/#see-also","title":"See Also","text":"<ul> <li>Constraint Solver \u2014 Version resolution algorithm</li> <li>Update Strategies \u2014 Detailed strategy guide</li> <li>DESIGN.md \u2014 Full design document</li> </ul>"},{"location":"architecture/solver/","title":"Constraint Solver","text":"<p>The constraint solver finds compatible versions of Paper and plugins that satisfy all requirements.</p>"},{"location":"architecture/solver/#problem-statement","title":"Problem Statement","text":"<p>Given:</p> <ul> <li>A set of PaperMCServer instances with their current versions</li> <li>A set of Plugins with available versions and compatibility metadata</li> <li>Relationships defined by label selectors</li> </ul> <p>Find:</p> <ul> <li>Maximum Paper version compatible with ALL matched plugins</li> <li>Maximum plugin version compatible with ALL matched servers</li> </ul>"},{"location":"architecture/solver/#algorithm","title":"Algorithm","text":""},{"location":"architecture/solver/#plugin-version-resolution","title":"Plugin Version Resolution","text":"<p>For a Plugin with <code>updateStrategy: latest</code>:</p> <pre><code>1. Collect all matched PaperMCServer instances\n2. Filter plugin versions by updateDelay:\n   - Skip versions newer than (now - updateDelay)\n3. For each plugin version (descending):\n   - Check if compatible with ALL matched servers\n   - If yes: return this version\n4. If no compatible version found:\n   - Emit warning\n   - Keep current version\n</code></pre>"},{"location":"architecture/solver/#server-version-resolution","title":"Server Version Resolution","text":"<p>For a PaperMCServer with <code>updateStrategy: auto</code>:</p> <pre><code>1. Collect all matched Plugin resources\n2. Get available Paper versions from Docker Hub\n3. Filter by updateDelay\n4. For each Paper version (descending):\n   - For each matched plugin:\n     - Check if ANY plugin version is compatible\n   - If all plugins have compatible versions:\n     - Return this Paper version\n5. If no compatible version found:\n   - Set updateBlocked: true\n   - Keep current version\n</code></pre>"},{"location":"architecture/solver/#compatibility-check","title":"Compatibility Check","text":"<p>A plugin version is compatible with a server if:</p> <pre><code>serverVersion \u2208 plugin.minecraftVersions\n</code></pre> <p>Where <code>minecraftVersions</code> comes from:</p> <ol> <li>Plugin repository metadata (Hangar API)</li> <li><code>compatibilityOverride</code> if enabled</li> </ol>"},{"location":"architecture/solver/#example","title":"Example","text":""},{"location":"architecture/solver/#scenario","title":"Scenario","text":"<pre><code># Server running 1.20.4\nPaperMCServer:\n  name: survival\n  labels:\n    environment: production\n  status:\n    currentVersion: \"1.20.4\"\n\n# Plugin A - compatible with 1.20.x and 1.21.x\nPlugin:\n  name: essentialsx\n  instanceSelector:\n    matchLabels:\n      environment: production\n  status:\n    availableVersions:\n      - version: \"2.21.0\"\n        minecraftVersions: [\"1.20.4\", \"1.21.1\"]\n      - version: \"2.20.1\"\n        minecraftVersions: [\"1.19.4\", \"1.20.4\"]\n\n# Plugin B - only compatible with 1.20.x\nPlugin:\n  name: old-plugin\n  instanceSelector:\n    matchLabels:\n      environment: production\n  status:\n    availableVersions:\n      - version: \"1.5.0\"\n        minecraftVersions: [\"1.20.4\", \"1.20.6\"]\n</code></pre>"},{"location":"architecture/solver/#resolution","title":"Resolution","text":"<p>Server version resolution (with <code>updateStrategy: auto</code>):</p> <ol> <li>Available Paper versions: <code>[1.21.4, 1.21.1, 1.20.6, 1.20.4, ...]</code></li> <li>Check 1.21.4:</li> <li>EssentialsX: No compatible version \u2192 SKIP</li> <li>Check 1.21.1:</li> <li>EssentialsX: 2.21.0 compatible \u2713</li> <li>old-plugin: No compatible version \u2192 SKIP</li> <li>Check 1.20.6:</li> <li>EssentialsX: 2.21.0 compatible \u2713</li> <li>old-plugin: 1.5.0 compatible \u2713</li> <li>Result: 1.20.6</li> </ol> <p>Plugin version resolution (EssentialsX with <code>updateStrategy: latest</code>):</p> <ol> <li>Matched servers: <code>[survival (1.20.4)]</code></li> <li>Check 2.21.0:</li> <li>Compatible with survival (1.20.4 \u2208 [1.20.4, 1.21.1]) \u2713</li> <li>Result: 2.21.0</li> </ol>"},{"location":"architecture/solver/#update-delay","title":"Update Delay","text":"<p>The <code>updateDelay</code> field adds a grace period before using new versions:</p> <pre><code>eligibleVersions = versions.filter(v =&gt;\n  v.releasedAt &lt; (now - updateDelay)\n)\n</code></pre> <p>This allows waiting for community feedback on new releases.</p>"},{"location":"architecture/solver/#example_1","title":"Example","text":"<pre><code>spec:\n  updateDelay: 168h  # 7 days\n</code></pre> <p>If today is January 15<sup>th</sup>:</p> Version Released Eligible 2.21.0 Jan 14 No (1 day old) 2.20.1 Jan 5 Yes (10 days old) 2.20.0 Dec 20 Yes (26 days old)"},{"location":"architecture/solver/#conflict-resolution","title":"Conflict Resolution","text":""},{"location":"architecture/solver/#multiple-plugins-same-project","title":"Multiple Plugins, Same Project","text":"<p>When multiple Plugin resources reference the same project:</p> Scenario Resolution Any has <code>latest</code> Solver picks optimal version All have <code>pin</code> Highest semver wins + warning"},{"location":"architecture/solver/#no-compatible-version","title":"No Compatible Version","text":"<p>When no compatible version exists:</p> <ol> <li>Plugin sets <code>conditions.Compatible: False</code></li> <li>Server sets <code>updateBlocked: true</code> with reason</li> <li>Current version remains installed</li> <li>Operator logs warning</li> </ol>"},{"location":"architecture/solver/#repository-unavailable","title":"Repository Unavailable","text":"<p>When the plugin repository is unreachable:</p> <ol> <li>Use cached <code>status.availableVersions</code></li> <li>Set <code>repositoryStatus: orphaned</code></li> <li>Continue with cached data</li> <li>Log warning for operator</li> </ol>"},{"location":"architecture/solver/#implementation","title":"Implementation","text":"<p>The solver is implemented in <code>pkg/solver/</code>:</p> <pre><code>type Solver interface {\n    // FindBestPluginVersion finds the maximum plugin version compatible with ALL matched servers.\n    FindBestPluginVersion(\n        ctx context.Context,\n        plugin *mcv1beta1.Plugin,\n        servers []mcv1beta1.PaperMCServer,\n        allVersions []plugins.PluginVersion,\n    ) (string, error)\n\n    // FindBestPaperVersion finds the maximum Paper version compatible with ALL matched plugins.\n    FindBestPaperVersion(\n        ctx context.Context,\n        server *mcv1beta1.PaperMCServer,\n        matchedPlugins []mcv1beta1.Plugin,\n        paperVersions []string,\n    ) (string, error)\n}\n</code></pre>"},{"location":"architecture/solver/#current-implementation","title":"Current Implementation","text":"<p>The MVP uses a simple linear search algorithm:</p> <ol> <li>Sort versions descending (newest first)</li> <li>Check each version for compatibility</li> <li>Return first compatible version</li> </ol>"},{"location":"architecture/solver/#future-sat-solver","title":"Future: SAT Solver","text":"<p>For complex multi-server, multi-plugin scenarios, a SAT solver may be implemented:</p> <ul> <li>Model constraints as boolean satisfiability</li> <li>Use a SAT solver library for optimal solutions</li> <li>Handle complex dependency graphs</li> </ul>"},{"location":"architecture/solver/#see-also","title":"See Also","text":"<ul> <li>Design \u2014 System architecture</li> <li>Update Strategies \u2014 Version management options</li> <li>PaperMCServer \u2014 Server configuration</li> <li>Plugin \u2014 Plugin configuration</li> </ul>"},{"location":"configuration/","title":"Configuration","text":"<p>This section covers the configuration of Minecraft Operator's Custom Resource Definitions (CRDs).</p>"},{"location":"configuration/#custom-resources","title":"Custom Resources","text":"<p>The operator defines two main CRDs:</p> Resource API Group Description PaperMCServer <code>mc.k8s.lex.la/v1beta1</code> Defines a Minecraft server instance Plugin <code>mc.k8s.lex.la/v1beta1</code> Defines a plugin for matched servers"},{"location":"configuration/#resource-relationship","title":"Resource Relationship","text":"<pre><code>graph LR\n    P1[Plugin A] --&gt;|instanceSelector| S1[PaperMCServer 1]\n    P1 --&gt;|instanceSelector| S2[PaperMCServer 2]\n    P2[Plugin B] --&gt;|instanceSelector| S1\n    P3[Plugin C] --&gt;|instanceSelector| S2\n\n    subgraph \"Constraint Solver\"\n        S1 --&gt; V1[Version Resolution]\n        S2 --&gt; V2[Version Resolution]\n    end</code></pre> <p>Plugins are matched to servers via label selectors. The constraint solver ensures all plugins are compatible with the selected Paper version.</p>"},{"location":"configuration/#sections","title":"Sections","text":"<ul> <li> <p> PaperMCServer</p> <p>Complete reference for PaperMCServer CRD fields</p> <p> PaperMCServer</p> </li> <li> <p> Plugin</p> <p>Complete reference for Plugin CRD fields</p> <p> Plugin</p> </li> <li> <p> Update Strategies</p> <p>Detailed guide to version management strategies</p> <p> Update Strategies</p> </li> </ul>"},{"location":"configuration/#quick-reference","title":"Quick Reference","text":""},{"location":"configuration/#papermcserver-update-strategies","title":"PaperMCServer Update Strategies","text":"Strategy Description Use Case <code>latest</code> Always newest Paper version Testing, bleeding edge <code>auto</code> Solver picks best compatible version Recommended for production <code>pin</code> Fixed version, auto-update builds Stability with security updates <code>build-pin</code> Fully pinned version and build Maximum stability"},{"location":"configuration/#plugin-update-strategies","title":"Plugin Update Strategies","text":"Strategy Description Use Case <code>latest</code> Always newest compatible version Most plugins <code>auto</code> Solver picks best compatible version Multi-server compatibility <code>pin</code> Fixed version, auto-update builds Stable versions with bug fixes <code>build-pin</code> Fully pinned version and build Maximum stability"},{"location":"configuration/#example-configurations","title":"Example Configurations","text":""},{"location":"configuration/#production-server-with-plugins","title":"Production Server with Plugins","text":"<pre><code>apiVersion: mc.k8s.lex.la/v1beta1\nkind: PaperMCServer\nmetadata:\n  name: production\n  labels:\n    environment: production\nspec:\n  updateStrategy: \"auto\"\n  updateSchedule:\n    checkCron: \"0 3 * * *\"\n    maintenanceWindow:\n      enabled: true\n      cron: \"0 4 * * 0\"\n---\napiVersion: mc.k8s.lex.la/v1beta1\nkind: Plugin\nmetadata:\n  name: essentialsx\nspec:\n  source:\n    type: hangar\n    project: \"EssentialsX/Essentials\"\n  updateStrategy: \"latest\"\n  instanceSelector:\n    matchLabels:\n      environment: production\n</code></pre>"},{"location":"configuration/#pinned-version-for-stability","title":"Pinned Version for Stability","text":"<pre><code>apiVersion: mc.k8s.lex.la/v1beta1\nkind: PaperMCServer\nmetadata:\n  name: stable\nspec:\n  updateStrategy: \"pin\"\n  version: \"1.21.1\"  # Pinned Minecraft version\n  updateSchedule:\n    checkCron: \"0 3 * * *\"\n</code></pre>"},{"location":"configuration/#next-steps","title":"Next Steps","text":"<ul> <li>PaperMCServer Reference \u2014 All server configuration options</li> <li>Plugin Reference \u2014 All plugin configuration options</li> <li>Update Strategies \u2014 Deep dive into version management</li> </ul>"},{"location":"configuration/papermcserver/","title":"PaperMCServer","text":"<p>The <code>PaperMCServer</code> CRD defines a Minecraft server instance managed by the operator.</p>"},{"location":"configuration/papermcserver/#overview","title":"Overview","text":"<pre><code>apiVersion: mc.k8s.lex.la/v1beta1\nkind: PaperMCServer\nmetadata:\n  name: my-server\n  namespace: minecraft\nspec:\n  updateStrategy: \"auto\"\n  # ... configuration\n</code></pre>"},{"location":"configuration/papermcserver/#spec-fields","title":"Spec Fields","text":""},{"location":"configuration/papermcserver/#updatestrategy","title":"updateStrategy","text":"<p>Required \u2014 Defines how Paper version updates are handled.</p> Value Description <code>latest</code> Always use newest Paper version from Docker Hub (ignores plugin compatibility) <code>auto</code> Constraint solver picks best version compatible with all plugins <code>pin</code> Stay on specific version, auto-update to latest build <code>build-pin</code> Fully pinned version and build, no automatic updates <pre><code>spec:\n  updateStrategy: \"auto\"  # Recommended for production\n</code></pre> <p>See Update Strategies for detailed guide.</p>"},{"location":"configuration/papermcserver/#version","title":"version","text":"<p>Optional \u2014 Target Paper version. Required for <code>pin</code> and <code>build-pin</code> strategies.</p> <pre><code>spec:\n  updateStrategy: \"pin\"\n  version: \"1.21.1\"  # Pinned Minecraft version\n</code></pre>"},{"location":"configuration/papermcserver/#build","title":"build","text":"<p>Optional \u2014 Target Paper build number.</p> <ul> <li>With <code>pin</code> strategy: minimum build (operator will still auto-update to newer builds)</li> <li>With <code>build-pin</code> strategy: exact build (no automatic updates)</li> </ul> <pre><code>spec:\n  updateStrategy: \"build-pin\"\n  version: \"1.21.1\"\n  build: 125  # Exact build number\n</code></pre>"},{"location":"configuration/papermcserver/#updatedelay","title":"updateDelay","text":"<p>Optional \u2014 Grace period before applying Paper updates. Useful for waiting for community feedback on new releases.</p> <pre><code>spec:\n  updateDelay: \"168h\"  # Wait 7 days before applying updates\n</code></pre>"},{"location":"configuration/papermcserver/#updateschedule","title":"updateSchedule","text":"<p>Required \u2014 Defines when to check and apply updates.</p> Field Description <code>checkCron</code> Cron expression for checking updates <code>maintenanceWindow.enabled</code> Enable scheduled updates <code>maintenanceWindow.cron</code> Cron expression for applying updates <pre><code>spec:\n  updateSchedule:\n    checkCron: \"0 3 * * *\"           # Check daily at 3am\n    maintenanceWindow:\n      enabled: true\n      cron: \"0 4 * * 0\"              # Apply updates Sunday 4am\n</code></pre> <p>Cron Format</p> <p>Standard cron format: <code>minute hour day-of-month month day-of-week</code></p>"},{"location":"configuration/papermcserver/#gracefulshutdown","title":"gracefulShutdown","text":"<p>Required \u2014 Configures graceful server shutdown.</p> Field Description <code>timeout</code> Shutdown timeout (should match <code>terminationGracePeriodSeconds</code>) <pre><code>spec:\n  gracefulShutdown:\n    timeout: 300s  # 5 minutes for world save\n</code></pre> <p>Timeout Configuration</p> <p>The timeout should match your StatefulSet's <code>terminationGracePeriodSeconds</code>. Too short may cause world corruption. Minimum recommended: 300s.</p>"},{"location":"configuration/papermcserver/#rcon","title":"rcon","text":"<p>Required \u2014 Configures RCON for graceful shutdown commands.</p> Field Description Default <code>enabled</code> Enable RCON \u2014 <code>passwordSecret.name</code> Secret name \u2014 <code>passwordSecret.key</code> Key in Secret \u2014 <code>port</code> RCON port <code>25575</code> <pre><code>spec:\n  rcon:\n    enabled: true\n    passwordSecret:\n      name: my-server-rcon\n      key: password\n    port: 25575\n</code></pre> <p>Create the secret:</p> <pre><code>kubectl create secret generic my-server-rcon \\\n  --from-literal=password=your-secure-password\n</code></pre>"},{"location":"configuration/papermcserver/#service","title":"service","text":"<p>Optional \u2014 Configures the Kubernetes Service for the server.</p> Field Description Default <code>type</code> Service type <code>LoadBalancer</code> <code>annotations</code> Custom annotations \u2014 <code>loadBalancerIP</code> Static IP for LoadBalancer \u2014 <pre><code>spec:\n  service:\n    type: LoadBalancer\n    annotations:\n      metallb.universe.tf/loadBalancerIPs: \"192.168.1.100\"\n    loadBalancerIP: \"192.168.1.100\"\n</code></pre>"},{"location":"configuration/papermcserver/#podtemplate","title":"podTemplate","text":"<p>Required \u2014 Template for the StatefulSet pod.</p> <p>This is a standard Kubernetes <code>PodTemplateSpec</code>. Key fields:</p> Field Description <code>spec.containers[0].resources</code> CPU/memory requests and limits <code>spec.containers[0].env</code> Environment variables <code>spec.volumes</code> Additional volumes <pre><code>spec:\n  podTemplate:\n    spec:\n      containers:\n        - name: minecraft\n          resources:\n            requests:\n              memory: \"2Gi\"\n              cpu: \"500m\"\n            limits:\n              memory: \"4Gi\"\n          env:\n            - name: JAVA_OPTS\n              value: \"-Xmx3G -Xms1G\"\n      volumes:\n        - name: config\n          configMap:\n            name: server-config\n</code></pre>"},{"location":"configuration/papermcserver/#status-fields","title":"Status Fields","text":"<p>The operator updates the status to reflect the current state.</p>"},{"location":"configuration/papermcserver/#currentversion-currentbuild","title":"currentVersion / currentBuild","text":"<p>Currently running Paper version and build.</p> <pre><code>status:\n  currentVersion: \"1.21.4\"\n  currentBuild: 125\n</code></pre>"},{"location":"configuration/papermcserver/#desiredversion-desiredbuild","title":"desiredVersion / desiredBuild","text":"<p>Target version the operator wants to run (resolved from updateStrategy).</p> <pre><code>status:\n  desiredVersion: \"1.21.4\"\n  desiredBuild: 130\n</code></pre>"},{"location":"configuration/papermcserver/#plugins","title":"plugins","text":"<p>List of matched Plugin resources and their versions.</p> <pre><code>status:\n  plugins:\n    - pluginRef:\n        name: essentialsx\n        namespace: minecraft\n      resolvedVersion: \"2.21.0\"\n      currentVersion: \"2.20.1\"\n      desiredVersion: \"2.21.0\"\n      compatible: true\n      source: hangar\n</code></pre>"},{"location":"configuration/papermcserver/#availableupdate","title":"availableUpdate","text":"<p>Next available update if any.</p> <pre><code>status:\n  availableUpdate:\n    version: \"1.21.4\"\n    build: 130\n    releasedAt: \"2024-01-15T10:00:00Z\"\n    foundAt: \"2024-01-16T03:00:00Z\"\n    plugins:\n      - pluginRef:\n          name: essentialsx\n          namespace: minecraft\n        version: \"2.21.0\"\n</code></pre>"},{"location":"configuration/papermcserver/#lastupdate","title":"lastUpdate","text":"<p>Record of the most recent update attempt.</p> <pre><code>status:\n  lastUpdate:\n    appliedAt: \"2024-01-14T04:00:00Z\"\n    previousVersion: \"1.21.3\"\n    successful: true\n</code></pre>"},{"location":"configuration/papermcserver/#updateblocked","title":"updateBlocked","text":"<p>Indicates if updates are blocked due to compatibility issues.</p> <pre><code>status:\n  updateBlocked:\n    blocked: true\n    reason: \"Plugin incompatible with target version\"\n    blockedBy:\n      plugin: \"old-plugin\"\n      version: \"1.0.0\"\n      supportedVersions:\n        - \"1.20.4\"\n        - \"1.20.6\"\n</code></pre>"},{"location":"configuration/papermcserver/#conditions","title":"conditions","text":"<p>Standard Kubernetes conditions.</p> Type Description <code>Ready</code> Server reconciled successfully <code>StatefulSetReady</code> StatefulSet has ready replicas <code>UpdateAvailable</code> New Paper version/build available <code>UpdateBlocked</code> Update blocked by plugin incompatibility <code>Updating</code> Update currently in progress <code>SolverRunning</code> Constraint solver is executing <code>CronScheduleValid</code> Maintenance window cron is valid"},{"location":"configuration/papermcserver/#complete-example","title":"Complete Example","text":"<pre><code>apiVersion: mc.k8s.lex.la/v1beta1\nkind: PaperMCServer\nmetadata:\n  name: survival\n  namespace: minecraft\n  labels:\n    environment: production\n    server-type: survival\nspec:\n  updateStrategy: \"auto\"\n  updateDelay: \"168h\"  # Wait 7 days\n\n  updateSchedule:\n    checkCron: \"0 3 * * *\"\n    maintenanceWindow:\n      enabled: true\n      cron: \"0 4 * * 0\"\n\n  gracefulShutdown:\n    timeout: 300s\n\n  rcon:\n    enabled: true\n    passwordSecret:\n      name: survival-rcon\n      key: password\n\n  service:\n    type: LoadBalancer\n    annotations:\n      external-dns.alpha.kubernetes.io/hostname: survival.minecraft.example.com\n\n  podTemplate:\n    spec:\n      containers:\n        - name: minecraft\n          resources:\n            requests:\n              memory: \"4Gi\"\n              cpu: \"1\"\n            limits:\n              memory: \"8Gi\"\n          env:\n            - name: JAVA_OPTS\n              value: \"-Xmx6G -Xms2G -XX:+UseG1GC\"\n      nodeSelector:\n        minecraft: \"true\"\n      tolerations:\n        - key: \"minecraft\"\n          operator: \"Exists\"\n          effect: \"NoSchedule\"\n</code></pre>"},{"location":"configuration/papermcserver/#see-also","title":"See Also","text":"<ul> <li>Plugin \u2014 Plugin CRD reference</li> <li>Update Strategies \u2014 Detailed version management guide</li> <li>Troubleshooting \u2014 Common issues</li> </ul>"},{"location":"configuration/plugin/","title":"Plugin","text":"<p>The <code>Plugin</code> CRD defines a Minecraft plugin to be installed on matched servers.</p>"},{"location":"configuration/plugin/#overview","title":"Overview","text":"<pre><code>apiVersion: mc.k8s.lex.la/v1beta1\nkind: Plugin\nmetadata:\n  name: essentialsx\n  namespace: minecraft\nspec:\n  source:\n    type: hangar\n    project: \"EssentialsX/Essentials\"\n  updateStrategy: \"latest\"\n  instanceSelector:\n    matchLabels:\n      environment: production\n</code></pre>"},{"location":"configuration/plugin/#spec-fields","title":"Spec Fields","text":""},{"location":"configuration/plugin/#source","title":"source","text":"<p>Required \u2014 Defines where to fetch the plugin.</p> Field Description <code>type</code> Repository type (see supported sources below) <code>project</code> Plugin identifier (for hangar) <code>url</code> Direct download URL (planned) <pre><code>spec:\n  source:\n    type: hangar\n    project: \"EssentialsX/Essentials\"\n</code></pre> <p>Supported Sources</p> <p>Currently implemented:</p> <ul> <li><code>hangar</code> \u2014 PaperMC Hangar (hangar.papermc.io)</li> </ul> <p>Planned (not yet implemented):</p> <ul> <li><code>modrinth</code> \u2014 #2</li> <li><code>spigot</code> \u2014 #3</li> <li><code>url</code> \u2014 #4</li> </ul>"},{"location":"configuration/plugin/#updatestrategy","title":"updateStrategy","text":"<p>Optional \u2014 Defines how plugin versions are managed. Default: <code>latest</code>.</p> Value Description <code>latest</code> Always use newest version from repository <code>auto</code> Constraint solver picks best version compatible with servers <code>pin</code> Pin to specific version (requires <code>version</code> field) <code>build-pin</code> Pin to specific version and build <pre><code>spec:\n  updateStrategy: \"latest\"\n</code></pre>"},{"location":"configuration/plugin/#version","title":"version","text":"<p>Optional \u2014 Target plugin version. Required for <code>pin</code> and <code>build-pin</code> strategies.</p> <pre><code>spec:\n  updateStrategy: \"pin\"\n  version: \"2.20.1\"\n</code></pre>"},{"location":"configuration/plugin/#build","title":"build","text":"<p>Optional \u2014 Target build number. Only used with <code>build-pin</code> strategy.</p> <pre><code>spec:\n  updateStrategy: \"build-pin\"\n  version: \"2.20.1\"\n  build: 456\n</code></pre>"},{"location":"configuration/plugin/#updatedelay","title":"updateDelay","text":"<p>Optional \u2014 Grace period before applying new plugin versions.</p> <pre><code>spec:\n  updateDelay: \"72h\"  # Wait 3 days before using new releases\n</code></pre>"},{"location":"configuration/plugin/#instanceselector","title":"instanceSelector","text":"<p>Required \u2014 Label selector to match PaperMCServer instances.</p> <pre><code>spec:\n  instanceSelector:\n    matchLabels:\n      environment: production\n      server-type: survival\n</code></pre> <p>Or with expressions:</p> <pre><code>spec:\n  instanceSelector:\n    matchExpressions:\n      - key: environment\n        operator: In\n        values:\n          - production\n          - staging\n</code></pre>"},{"location":"configuration/plugin/#port","title":"port","text":"<p>Optional \u2014 Network port exposed by the plugin. Added to matched servers' Services.</p> <p>Useful for plugins with web interfaces (Dynmap, BlueMap, Plan).</p> <pre><code>spec:\n  port: 8123  # Dynmap web interface\n</code></pre> <p>Port Handling</p> <p>The port is added as both TCP and UDP to the Service. Port name format: <code>plugin-{pluginname}</code></p>"},{"location":"configuration/plugin/#compatibilityoverride","title":"compatibilityOverride","text":"<p>Optional \u2014 Manual compatibility specification for plugins without proper metadata.</p> Field Description <code>enabled</code> Enable the override <code>minecraftVersions</code> List of compatible Minecraft versions <pre><code>spec:\n  compatibilityOverride:\n    enabled: true\n    minecraftVersions:\n      - \"1.20.4\"\n      - \"1.20.6\"\n      - \"1.21.1\"\n</code></pre> <p>Use Sparingly</p> <p>Only use compatibility overrides when the plugin repository lacks version metadata. Incorrect overrides may cause plugin compatibility issues.</p>"},{"location":"configuration/plugin/#status-fields","title":"Status Fields","text":""},{"location":"configuration/plugin/#availableversions","title":"availableVersions","text":"<p>Cached metadata from the plugin repository.</p> <pre><code>status:\n  availableVersions:\n    - version: \"2.21.0\"\n      minecraftVersions:\n        - \"1.20.4\"\n        - \"1.21.1\"\n      downloadURL: \"https://...\"\n      hash: \"sha256:abc123...\"\n      cachedAt: \"2024-01-15T10:00:00Z\"\n      releasedAt: \"2024-01-10T12:00:00Z\"\n</code></pre>"},{"location":"configuration/plugin/#matchedinstances","title":"matchedInstances","text":"<p>Servers matched by the instanceSelector.</p> <pre><code>status:\n  matchedInstances:\n    - name: survival\n      namespace: minecraft\n      version: \"1.21.4\"\n      compatible: true\n    - name: creative\n      namespace: minecraft\n      version: \"1.20.4\"\n      compatible: true\n</code></pre>"},{"location":"configuration/plugin/#repositorystatus","title":"repositoryStatus","text":"<p>Plugin repository availability.</p> Value Description <code>available</code> Repository accessible, metadata current <code>unavailable</code> Repository temporarily unreachable <code>orphaned</code> Repository removed, using cached data"},{"location":"configuration/plugin/#lastfetched","title":"lastFetched","text":"<p>Timestamp of the last successful API fetch.</p> <pre><code>status:\n  lastFetched: \"2024-01-15T10:00:00Z\"\n</code></pre>"},{"location":"configuration/plugin/#conditions","title":"conditions","text":"<p>Standard Kubernetes conditions.</p> Type Description <code>Ready</code> Plugin reconciled successfully <code>RepositoryAvailable</code> Plugin repository is accessible <code>VersionResolved</code> Metadata fetched and servers matched"},{"location":"configuration/plugin/#complete-example","title":"Complete Example","text":"<pre><code>apiVersion: mc.k8s.lex.la/v1beta1\nkind: Plugin\nmetadata:\n  name: bluemap\n  namespace: minecraft\nspec:\n  source:\n    type: hangar\n    project: \"BlueMap/BlueMap\"\n\n  updateStrategy: \"latest\"\n  updateDelay: \"168h\"  # Wait 7 days\n\n  # Match all production servers\n  instanceSelector:\n    matchLabels:\n      environment: production\n\n  # Expose BlueMap web interface\n  port: 8100\n\n---\napiVersion: mc.k8s.lex.la/v1beta1\nkind: Plugin\nmetadata:\n  name: essentialsx\n  namespace: minecraft\nspec:\n  source:\n    type: hangar\n    project: \"EssentialsX/Essentials\"\n\n  updateStrategy: \"pin\"\n  version: \"2.20.1\"\n\n  instanceSelector:\n    matchLabels:\n      environment: production\n\n---\napiVersion: mc.k8s.lex.la/v1beta1\nkind: Plugin\nmetadata:\n  name: worldedit\n  namespace: minecraft\nspec:\n  source:\n    type: hangar\n    project: \"EngineHub/WorldEdit\"\n\n  updateStrategy: \"auto\"\n\n  instanceSelector:\n    matchExpressions:\n      - key: server-type\n        operator: In\n        values:\n          - creative\n          - build\n</code></pre>"},{"location":"configuration/plugin/#plugin-deletion","title":"Plugin Deletion","text":"<p>When a Plugin is deleted:</p> <ol> <li>The operator marks the plugin for deletion on matched servers</li> <li>During next server restart, the JAR file is removed from <code>/data/plugins/</code></li> <li>Once all JARs are cleaned up, the Plugin resource is fully deleted</li> </ol> <p>Check deletion progress:</p> <pre><code>kubectl get plugin essentialsx -o yaml\n</code></pre> <pre><code>status:\n  deletionProgress:\n    - serverName: survival\n      namespace: minecraft\n      jarDeleted: true\n      deletedAt: \"2024-01-15T04:00:00Z\"\n    - serverName: creative\n      namespace: minecraft\n      jarDeleted: false\n</code></pre>"},{"location":"configuration/plugin/#see-also","title":"See Also","text":"<ul> <li>PaperMCServer \u2014 Server CRD reference</li> <li>Update Strategies \u2014 Version management guide</li> <li>Architecture \u2014 Constraint solver details</li> </ul>"},{"location":"configuration/update-strategies/","title":"Update Strategies","text":"<p>This document describes the update strategies available in the minecraft-operator for managing Paper server versions and plugin versions.</p>"},{"location":"configuration/update-strategies/#overview","title":"Overview","text":"<p>The minecraft-operator provides flexible update strategies that allow you to control how your PaperMC servers and plugins are updated. Both <code>PaperMCServer</code> and <code>Plugin</code> resources support update strategies, giving you fine-grained control over version management.</p> <p>Key principles:</p> <ul> <li>Never uses <code>:latest</code> Docker tags - The operator always resolves to concrete version-build combinations (e.g., <code>1.21.1-91</code>)</li> <li>Unified approach - Similar concepts across both server and plugin resources</li> <li>Compatibility-first - The constraint solver ensures all components work together</li> <li>Scheduled updates - Updates only happen during configured maintenance windows</li> </ul>"},{"location":"configuration/update-strategies/#version-and-build-concepts","title":"Version and Build Concepts","text":"<p>Understanding the difference between versions and builds is essential:</p>"},{"location":"configuration/update-strategies/#paper-versioning","title":"Paper Versioning","text":"<p>Paper uses a two-part versioning scheme:</p> <ul> <li>Version: The Minecraft version (e.g., <code>1.21.1</code>, <code>1.20.4</code>)</li> <li>Build: The Paper build number for that version (e.g., <code>91</code>, <code>115</code>)</li> <li>Docker tag: Combines both as <code>{version}-{build}</code> (e.g., <code>1.21.1-91</code>)</li> </ul> <p>Example timeline for Paper 1.21.1:</p> <ul> <li><code>1.21.1-86</code> (initial release)</li> <li><code>1.21.1-87</code> (bug fixes)</li> <li><code>1.21.1-91</code> (latest build)</li> </ul> <p>Build updates are typically bug fixes and performance improvements without gameplay changes. Version updates introduce new Minecraft features and may break plugin compatibility.</p>"},{"location":"configuration/update-strategies/#plugin-versioning","title":"Plugin Versioning","text":"<p>Plugins typically use semantic versioning:</p> <ul> <li>Standard semver: <code>2.5.0</code>, <code>1.18.2</code>, <code>3.0.1</code></li> <li>Some plugins include builds: <code>2.5.0-build.123</code></li> </ul> <p>The operator fetches version metadata from plugin repositories (Hangar, Modrinth, etc.) to determine compatibility.</p>"},{"location":"configuration/update-strategies/#papermcserver-update-strategies","title":"PaperMCServer Update Strategies","text":"<p>The <code>PaperMCServer</code> resource supports four update strategies via the <code>updateStrategy</code> field.</p>"},{"location":"configuration/update-strategies/#strategy-latest","title":"Strategy: <code>latest</code>","text":"<p>Purpose: Always run the newest available Paper version from Docker Hub.</p> <p>Behavior:</p> <ul> <li>Automatically updates to the latest Paper version (both version and build)</li> <li>Ignores plugin compatibility constraints</li> <li>Best for bleeding-edge testing or vanilla servers without plugins</li> </ul> <p>Version resolution:</p> <ul> <li>Queries Docker Hub for the latest available Paper image tag</li> <li>Resolves to the highest version-build combination (e.g., <code>1.21.1-91</code>)</li> </ul> <p>Update behavior:</p> <ul> <li>Updates happen during maintenance windows</li> <li>Both version upgrades (1.21.1 \u2192 1.21.2) and build upgrades (91 \u2192 92) are automatic</li> </ul> <p>Use cases:</p> <ul> <li>Test/development environments</li> <li>Vanilla servers (no plugins)</li> <li>Bleeding-edge experimental servers</li> <li>When you want the absolute latest features</li> </ul> <p>Example:</p> <pre><code>apiVersion: mc.k8s.lex.la/v1beta1\nkind: PaperMCServer\nmetadata:\n  name: test-server\nspec:\n  updateStrategy: \"latest\"\n  updateSchedule:\n    checkCron: \"0 3 * * *\"\n    maintenanceWindow:\n      enabled: true\n      cron: \"0 4 * * 0\"\n</code></pre> <p>Important notes:</p> <ul> <li>May break plugin compatibility</li> <li>Suitable for servers without plugins or with very flexible plugins</li> <li>Always resolves to concrete tag (never uses <code>:latest</code> Docker tag)</li> </ul>"},{"location":"configuration/update-strategies/#strategy-auto","title":"Strategy: <code>auto</code>","text":"<p>Purpose: Automatically pick the best Paper version compatible with all matched plugins.</p> <p>Behavior:</p> <ul> <li>Uses the constraint solver to find the maximum Paper version where ALL plugins have compatible versions</li> <li>Balances staying up-to-date with maintaining plugin compatibility</li> <li>The solver considers both Paper versions and plugin version compatibility</li> </ul> <p>Version resolution:</p> <ol> <li>Fetch all available Paper versions</li> <li>For each Paper version (newest first), check if ALL matched plugins have at least one compatible version</li> <li>Return the highest Paper version that satisfies all plugin constraints</li> <li>Respects <code>updateDelay</code> if configured</li> </ol> <p>Update behavior:</p> <ul> <li>Automatic version updates when solver finds a better solution</li> <li>Updates happen during maintenance windows</li> <li>Both version and build updates are automatic</li> <li>Blocks updates if no compatible solution exists</li> </ul> <p>Use cases:</p> <ul> <li>Production servers with multiple plugins</li> <li>When you want automatic updates but need plugin compatibility</li> <li>Servers where you trust the solver to make good decisions</li> <li>Balanced approach between stability and staying current</li> </ul> <p>Example:</p> <pre><code>apiVersion: mc.k8s.lex.la/v1beta1\nkind: PaperMCServer\nmetadata:\n  name: production-server\n  labels:\n    environment: production\n    type: modded\nspec:\n  updateStrategy: \"auto\"\n  updateDelay: 168h  # Wait 7 days before applying updates\n  updateSchedule:\n    checkCron: \"0 3 * * *\"\n    maintenanceWindow:\n      enabled: true\n      cron: \"0 4 * * 0\"\n</code></pre> <p>How it works on initial deployment:</p> <p>On first deployment, the solver analyzes all matched plugins and selects the best Paper version. The operator then sets the StatefulSet image to the resolved version-build tag (e.g., <code>lexfrei/papermc:1.21.1-91</code>).</p> <p>Status tracking:</p> <p>The operator maintains detailed status information:</p> <pre><code>status:\n  currentVersion: \"1.21.1\"\n  currentBuild: 91\n  desiredVersion: \"1.21.1\"\n  desiredBuild: 91\n  availableUpdate:\n    version: \"1.21.2\"\n    build: 115\n    releasedAt: \"2024-01-15T10:00:00Z\"\n    foundAt: \"2024-01-22T03:00:00Z\"\n</code></pre>"},{"location":"configuration/update-strategies/#strategy-pin","title":"Strategy: <code>pin</code>","text":"<p>Purpose: Pin to a specific Paper version but automatically update to the latest build.</p> <p>Behavior:</p> <ul> <li>Stays on the specified Paper version (e.g., <code>1.21.1</code>)</li> <li>Automatically updates to newer builds of that version (e.g., <code>91 \u2192 92 \u2192 95</code>)</li> <li>Build updates are typically safe (bug fixes, performance improvements)</li> </ul> <p>Version resolution:</p> <ul> <li>Uses the Paper version specified in <code>version</code> field</li> <li>Finds the latest build available for that version</li> <li>Validates compatibility with matched plugins (for the pinned version)</li> </ul> <p>Update behavior:</p> <ul> <li>No version updates (stays on pinned version)</li> <li>Automatic build updates during maintenance windows</li> <li>If you want to change versions, update the <code>version</code> field manually</li> </ul> <p>Use cases:</p> <ul> <li>Production servers that need stability on a specific Minecraft version</li> <li>When plugins only support a specific version range</li> <li>Gradual migration to new versions (manually update <code>version</code> when ready)</li> <li>When you want bug fixes but not feature changes</li> </ul> <p>Example:</p> <pre><code>apiVersion: mc.k8s.lex.la/v1beta1\nkind: PaperMCServer\nmetadata:\n  name: stable-server\nspec:\n  updateStrategy: \"pin\"\n  version: \"1.21.1\"  # Required for pin strategy\n  updateSchedule:\n    checkCron: \"0 3 * * *\"\n    maintenanceWindow:\n      enabled: true\n      cron: \"0 4 * * 0\"\n</code></pre> <p>Version changes:</p> <p>To upgrade to a new version, edit the spec:</p> <pre><code>kubectl patch papermcserver stable-server --type=merge -p '{\"spec\":{\"version\":\"1.21.2\"}}'\n</code></pre> <p>The operator will then resolve the latest build for 1.21.2 during the next maintenance window.</p>"},{"location":"configuration/update-strategies/#strategy-build-pin","title":"Strategy: <code>build-pin</code>","text":"<p>Purpose: Pin to both a specific Paper version AND build - no automatic updates.</p> <p>Behavior:</p> <ul> <li>Completely static configuration</li> <li>No automatic updates whatsoever</li> <li>Full manual control over both version and build</li> </ul> <p>Version resolution:</p> <ul> <li>Uses exact <code>version</code> and <code>build</code> specified in spec</li> <li>Validates the version-build combination exists</li> <li>Checks plugin compatibility for information purposes</li> </ul> <p>Update behavior:</p> <ul> <li>No automatic updates</li> <li>To update, manually change <code>version</code> and/or <code>build</code> fields</li> <li>Useful for maximum stability and predictability</li> </ul> <p>Use cases:</p> <ul> <li>Extremely sensitive production environments</li> <li>Certification/compliance requirements</li> <li>When you need exact reproducibility</li> <li>Regression testing against specific builds</li> <li>When any change requires approval/testing</li> </ul> <p>Example:</p> <pre><code>apiVersion: mc.k8s.lex.la/v1beta1\nkind: PaperMCServer\nmetadata:\n  name: certified-server\nspec:\n  updateStrategy: \"build-pin\"\n  version: \"1.21.1\"   # Required\n  build: 91            # Required\n  updateSchedule:\n    checkCron: \"0 3 * * *\"\n    maintenanceWindow:\n      enabled: true\n      cron: \"0 4 * * 0\"\n</code></pre> <p>Manual updates:</p> <pre><code># Update to a new build\nkubectl patch papermcserver certified-server --type=merge \\\n  -p '{\"spec\":{\"build\":95}}'\n\n# Update to a new version and build\nkubectl patch papermcserver certified-server --type=merge \\\n  -p '{\"spec\":{\"version\":\"1.21.2\",\"build\":115}}'\n</code></pre>"},{"location":"configuration/update-strategies/#plugin-update-strategies","title":"Plugin Update Strategies","text":"<p>The <code>Plugin</code> resource uses the same <code>updateStrategy</code> field as <code>PaperMCServer</code>, providing a unified approach to version management.</p>"},{"location":"configuration/update-strategies/#strategy-latest_1","title":"Strategy: <code>latest</code>","text":"<p>Purpose: Automatically use the latest plugin version compatible with matched servers.</p> <p>Behavior:</p> <ul> <li>Solver finds the maximum plugin version compatible with ALL matched servers</li> <li>Considers Paper versions of all servers this plugin applies to</li> <li>Respects <code>updateDelay</code> for stability</li> </ul> <p>Version resolution:</p> <ol> <li>Fetch all available plugin versions from the repository (Hangar, Modrinth, etc.)</li> <li>Filter versions by <code>updateDelay</code> (exclude too-new versions)</li> <li>For each version (newest first), check compatibility with ALL matched servers' Paper versions</li> <li>Return the highest compatible version</li> </ol> <p>Update behavior:</p> <ul> <li>Automatic updates when new compatible versions are available</li> <li>Updates respect server maintenance windows</li> <li>If multiple servers match, uses the most conservative compatible version</li> </ul> <p>Use cases:</p> <ul> <li>Plugins you want to keep current automatically</li> <li>Well-maintained plugins with good backward compatibility</li> <li>Non-critical plugins where updates are low-risk</li> </ul> <p>Example:</p> <pre><code>apiVersion: mc.k8s.lex.la/v1beta1\nkind: Plugin\nmetadata:\n  name: bluemap\nspec:\n  source:\n    type: hangar\n    project: \"BlueMap\"\n  updateStrategy: latest\n  updateDelay: 168h  # Wait 7 days before applying new versions\n  instanceSelector:\n    matchLabels:\n      type: vanilla\n</code></pre>"},{"location":"configuration/update-strategies/#strategy-auto_1","title":"Strategy: <code>auto</code>","text":"<p>Purpose: Let the solver pick the best plugin version compatible with all matched servers.</p> <p>Behavior:</p> <ul> <li>Solver finds optimal plugin version that works with all matched servers' Paper versions</li> <li>Automatically adapts as servers update their Paper versions</li> <li>Balances compatibility with staying current</li> </ul> <p>Version resolution:</p> <ol> <li>Fetch all available plugin versions from repository</li> <li>Filter versions by <code>updateDelay</code></li> <li>For each matched server, find plugin versions compatible with that server's Paper version</li> <li>Return the highest plugin version compatible with ALL servers</li> <li>If multiple servers run different Paper versions, picks most conservative compatible version</li> </ol> <p>Update behavior:</p> <ul> <li>Automatic updates when new compatible versions are available</li> <li>Updates respect server maintenance windows</li> <li>Adapts to server Paper version changes</li> </ul> <p>Use cases:</p> <ul> <li>Plugins that should stay compatible with server versions</li> <li>Multi-server environments with different Paper versions</li> <li>When you want automatic updates but need cross-server compatibility</li> <li>Plugins with good semantic versioning and compatibility metadata</li> </ul> <p>Example:</p> <pre><code>apiVersion: mc.k8s.lex.la/v1beta1\nkind: Plugin\nmetadata:\n  name: worldedit\nspec:\n  source:\n    type: hangar\n    project: \"WorldEdit\"\n  updateStrategy: auto\n  updateDelay: 168h\n  instanceSelector:\n    matchExpressions:\n      - key: type\n        operator: In\n        values: [\"creative\", \"modded\"]\n</code></pre> <p>How it works:</p> <ul> <li>Server A: Paper 1.21.1</li> <li>Server B: Paper 1.20.4</li> <li>Both match this plugin</li> <li>Plugin versions: 7.3.0 (1.21+), 7.2.0 (1.20-1.21), 7.1.0 (1.20)</li> <li>Solver picks 7.2.0 (compatible with both servers)</li> </ul>"},{"location":"configuration/update-strategies/#strategy-pin_1","title":"Strategy: <code>pin</code>","text":"<p>Purpose: Pin to a specific plugin version, with automatic build updates.</p> <p>Behavior:</p> <ul> <li>Uses the exact version specified in <code>version</code> field</li> <li>Automatically updates to newer builds of the same version (if available)</li> <li>Manual control over major/minor version, automatic patch/build updates</li> </ul> <p>Version resolution:</p> <ul> <li>Returns the <code>version</code> value directly</li> <li>Validates the version exists in the repository</li> <li>Automatically updates to latest build of that version</li> <li>Checks compatibility with matched servers (warning if incompatible)</li> </ul> <p>Update behavior:</p> <ul> <li>Build updates are automatic (e.g., 2.5.0-build.100 \u2192 2.5.0-build.101)</li> <li>Version updates require manual change of the <code>version</code> field</li> </ul> <p>Use cases:</p> <ul> <li>Critical plugins where stability is paramount</li> <li>Plugins known to have breaking changes between versions</li> <li>When you need to test plugin updates in staging first</li> <li>Regulatory/compliance requirements</li> </ul> <p>Example:</p> <pre><code>apiVersion: mc.k8s.lex.la/v1beta1\nkind: Plugin\nmetadata:\n  name: essentialsx\nspec:\n  source:\n    type: hangar\n    project: \"Essentials\"\n  updateStrategy: pin\n  version: \"2.20.1\"  # Required for pin strategy\n  instanceSelector:\n    matchLabels:\n      environment: production\n</code></pre> <p>Manual updates:</p> <pre><code>kubectl patch plugin essentialsx --type=merge \\\n  -p '{\"spec\":{\"version\":\"2.21.0\"}}'\n</code></pre>"},{"location":"configuration/update-strategies/#strategy-build-pin_1","title":"Strategy: <code>build-pin</code>","text":"<p>Purpose: Pin to exact plugin version and build - no automatic updates.</p> <p>Behavior:</p> <ul> <li>Completely static configuration</li> <li>No automatic updates whatsoever</li> <li>Full manual control over both version and build</li> <li>Maximum stability and reproducibility</li> </ul> <p>Version resolution:</p> <ul> <li>Uses exact <code>version</code> and <code>build</code> specified in spec</li> <li>Validates the version-build combination exists in repository</li> <li>Checks compatibility for information purposes only</li> </ul> <p>Update behavior:</p> <ul> <li>No automatic updates</li> <li>To update, manually change <code>version</code> and/or <code>build</code> fields</li> <li>Useful for maximum stability and predictability</li> </ul> <p>Use cases:</p> <ul> <li>Extremely critical plugins (permissions, economy, core mechanics)</li> <li>Certification/compliance requirements</li> <li>Exact reproducibility needed</li> <li>Regression testing against specific builds</li> <li>When any change requires approval/testing</li> </ul> <p>Example:</p> <pre><code>apiVersion: mc.k8s.lex.la/v1beta1\nkind: Plugin\nmetadata:\n  name: luckperms\nspec:\n  source:\n    type: hangar\n    project: \"LuckPerms\"\n  updateStrategy: build-pin\n  version: \"5.4.102\"  # Required\n  build: 1543         # Required\n  instanceSelector:\n    matchLabels:\n      environment: production\n      criticality: high\n</code></pre> <p>Manual updates:</p> <pre><code># Update to a new build\nkubectl patch plugin luckperms --type=merge \\\n  -p '{\"spec\":{\"build\":1550}}'\n\n# Update to a new version and build\nkubectl patch plugin luckperms --type=merge \\\n  -p '{\"spec\":{\"version\":\"5.4.110\",\"build\":1555}}'\n</code></pre>"},{"location":"configuration/update-strategies/#strategy-comparison","title":"Strategy Comparison","text":""},{"location":"configuration/update-strategies/#papermcserver-strategies","title":"PaperMCServer Strategies","text":"Strategy Automatic Version Updates Automatic Build Updates Version Selection Use Case <code>latest</code> Yes Yes Highest available from Hub Testing, vanilla servers <code>auto</code> Yes Yes Solver (plugin-compatible) Production with plugins <code>pin</code> No (manual) Yes Pinned version, latest build Stable version, get bug fixes <code>build-pin</code> No (manual) No (manual) Fully pinned Maximum stability, compliance"},{"location":"configuration/update-strategies/#plugin-strategies","title":"Plugin Strategies","text":"Strategy Automatic Version Updates Automatic Build Updates Version Selection Use Case <code>latest</code> Yes Yes Highest server-compatible Keep plugins current <code>auto</code> Yes Yes Solver (cross-server compatible) Multi-server compatibility <code>pin</code> No (manual) Yes Pinned version, latest build Stable version, get bug fixes <code>build-pin</code> No (manual) No (manual) Fully pinned Maximum stability, compliance"},{"location":"configuration/update-strategies/#common-configuration-scenarios","title":"Common Configuration Scenarios","text":""},{"location":"configuration/update-strategies/#scenario-1-production-server-with-automatic-plugin-updates","title":"Scenario 1: Production Server with Automatic Plugin Updates","text":"<p>Goal: Run a production server that stays on a stable Paper version but gets the latest compatible plugins.</p> <pre><code>apiVersion: mc.k8s.lex.la/v1beta1\nkind: PaperMCServer\nmetadata:\n  name: prod-server\n  labels:\n    environment: production\nspec:\n  updateStrategy: \"pin\"\n  version: \"1.21.1\"\n  updateDelay: 168h\n---\napiVersion: mc.k8s.lex.la/v1beta1\nkind: Plugin\nmetadata:\n  name: plugin-a\nspec:\n  updateStrategy: latest\n  updateDelay: 336h  # 14 days - more conservative for production\n  instanceSelector:\n    matchLabels:\n      environment: production\n</code></pre> <p>Result: Server stays on Paper 1.21.1 (with build updates), plugins update to latest compatible versions after 14-day delay.</p>"},{"location":"configuration/update-strategies/#scenario-2-fully-automatic-server","title":"Scenario 2: Fully Automatic Server","text":"<p>Goal: Development server that always runs the latest compatible versions of everything.</p> <pre><code>apiVersion: mc.k8s.lex.la/v1beta1\nkind: PaperMCServer\nmetadata:\n  name: dev-server\n  labels:\n    environment: dev\nspec:\n  updateStrategy: \"auto\"\n  updateDelay: 24h  # Short delay for dev\n---\napiVersion: mc.k8s.lex.la/v1beta1\nkind: Plugin\nmetadata:\n  name: plugin-b\nspec:\n  updateStrategy: latest\n  updateDelay: 24h\n  instanceSelector:\n    matchLabels:\n      environment: dev\n</code></pre> <p>Result: Both Paper and plugins update automatically to latest compatible versions after 24 hours.</p>"},{"location":"configuration/update-strategies/#scenario-3-maximum-stability","title":"Scenario 3: Maximum Stability","text":"<p>Goal: Production server with zero automatic updates - full manual control.</p> <pre><code>apiVersion: mc.k8s.lex.la/v1beta1\nkind: PaperMCServer\nmetadata:\n  name: critical-server\n  labels:\n    environment: production\n    criticality: high\nspec:\n  updateStrategy: \"build-pin\"\n  version: \"1.21.1\"\n  build: 91\n---\napiVersion: mc.k8s.lex.la/v1beta1\nkind: Plugin\nmetadata:\n  name: plugin-c\nspec:\n  updateStrategy: build-pin\n  version: \"2.5.0\"\n  build: 123\n  instanceSelector:\n    matchLabels:\n      criticality: high\n</code></pre> <p>Result: Nothing updates automatically. All changes require manual spec updates.</p>"},{"location":"configuration/update-strategies/#scenario-4-mixed-strategy-stable-server-experimental-plugins","title":"Scenario 4: Mixed Strategy - Stable Server, Experimental Plugins","text":"<p>Goal: Keep server version stable but allow some plugins to update automatically.</p> <pre><code>apiVersion: mc.k8s.lex.la/v1beta1\nkind: PaperMCServer\nmetadata:\n  name: mixed-server\n  labels:\n    type: mixed\nspec:\n  updateStrategy: \"pin\"\n  version: \"1.21.1\"\n---\n# Critical plugin - pinned\napiVersion: mc.k8s.lex.la/v1beta1\nkind: Plugin\nmetadata:\n  name: essential-plugin\nspec:\n  updateStrategy: pin\n  version: \"3.0.1\"\n  instanceSelector:\n    matchLabels:\n      type: mixed\n---\n# Non-critical plugin - latest\napiVersion: mc.k8s.lex.la/v1beta1\nkind: Plugin\nmetadata:\n  name: cosmetic-plugin\nspec:\n  updateStrategy: latest\n  updateDelay: 168h\n  instanceSelector:\n    matchLabels:\n      type: mixed\n</code></pre> <p>Result: Server gets build updates for 1.21.1. Essential plugin stays pinned. Cosmetic plugin updates automatically.</p>"},{"location":"configuration/update-strategies/#how-the-solver-works","title":"How the Solver Works","text":"<p>The constraint solver ensures compatibility between Paper versions and plugin versions.</p>"},{"location":"configuration/update-strategies/#for-plugin-version-resolution-updatestrategy-latest","title":"For Plugin Version Resolution (updateStrategy: latest)","text":"<ol> <li>Fetch all available plugin versions from repository</li> <li>Filter out versions newer than <code>now - updateDelay</code></li> <li>Sort versions in descending order (newest first)</li> <li>For each version:</li> <li>Check if compatible with ALL matched servers' Paper versions</li> <li>If yes, return this version</li> <li>If no, try next version</li> <li>If no compatible version found, report error</li> </ol> <p>Example:</p> <ul> <li>Plugin has versions: 3.0.0 (requires 1.21.x), 2.9.0 (requires 1.20-1.21), 2.8.0 (requires 1.20.x)</li> <li>Server A runs Paper 1.21.1</li> <li>Server B runs Paper 1.20.4</li> <li>Both servers match this plugin's selector</li> <li>Solver picks version 2.9.0 (compatible with both servers)</li> </ul>"},{"location":"configuration/update-strategies/#for-paper-version-resolution-updatestrategy-auto","title":"For Paper Version Resolution (updateStrategy: auto)","text":"<ol> <li>Fetch all available Paper versions</li> <li>Filter out versions newer than <code>now - updateDelay</code></li> <li>Sort versions in descending order (newest first)</li> <li>For each Paper version:</li> <li>For each matched plugin, check if at least one plugin version is compatible</li> <li>If ALL plugins have compatible versions, return this Paper version</li> <li>If not, try next Paper version</li> <li>If no compatible Paper version found, block updates</li> </ol> <p>Example:</p> <ul> <li>Paper versions available: 1.21.2, 1.21.1, 1.21.0</li> <li>Plugin A: compatible with 1.21.1, 1.21.0 (not yet updated for 1.21.2)</li> <li>Plugin B: compatible with 1.21.2, 1.21.1, 1.21.0</li> <li>Solver picks Paper 1.21.1 (highest version compatible with both plugins)</li> <li>Status shows <code>availableUpdate</code> with Paper 1.21.2 but blocked due to Plugin A</li> </ul>"},{"location":"configuration/update-strategies/#update-delay-behavior","title":"Update Delay Behavior","text":"<p>The <code>updateDelay</code> field provides a grace period before applying new versions, allowing the community to discover issues.</p> <p>Field specification:</p> <ul> <li>Type: Duration (e.g., <code>168h</code>, <code>336h</code>) \u2014 uses Go duration format (<code>h</code>, <code>m</code>, <code>s</code>)</li> <li>Optional: Yes (defaults to 0 = no delay)</li> <li>Applies to: Both <code>PaperMCServer</code> and <code>Plugin</code> resources</li> <li>Behavior: When not specified or set to <code>0</code>, updates apply immediately (subject to maintenance windows)</li> </ul> <p>How it works:</p> <ul> <li>When a new version is released, the operator records the release time</li> <li>The solver excludes versions where <code>releaseTime + updateDelay &gt; now</code></li> <li>After the delay expires, the version becomes eligible for updates</li> <li>Updates only apply during maintenance windows</li> </ul> <p>Example timeline:</p> <pre><code>Day 0:  Plugin 3.0.0 released\nDay 1:  Operator detects new version, records in availableVersions\nDay 7:  updateDelay expires (if set to 168h)\nDay 7+: Next maintenance window applies the update\n</code></pre> <p>Best practices:</p> <ul> <li>Development: <code>24h</code> - Quick updates for testing</li> <li>Staging: <code>168h</code> (7 days) - Standard delay</li> <li>Production: <code>336h</code> (14 days) - Conservative delay</li> <li>Critical production: Use <code>pin</code>/<code>build-pin</code> with manual updates</li> </ul>"},{"location":"configuration/update-strategies/#initial-deployment-behavior","title":"Initial Deployment Behavior","text":""},{"location":"configuration/update-strategies/#for-auto-strategy","title":"For <code>auto</code> Strategy","text":"<p>On initial deployment (no existing server):</p> <ol> <li>Operator analyzes all matched plugins</li> <li>Solver finds the best Paper version compatible with all plugins</li> <li>Operator creates StatefulSet with resolved image (e.g., <code>lexfrei/papermc:1.21.1-91</code>)</li> <li>Status is populated with current/desired versions</li> </ol> <p>Important: The <code>:latest</code> Docker tag is NEVER used. Even on first deployment, the operator resolves to a concrete version-build tag.</p>"},{"location":"configuration/update-strategies/#for-latest-strategy","title":"For <code>latest</code> Strategy","text":"<ol> <li>Query Docker Hub for latest available Paper image</li> <li>Extract version and build from tag</li> <li>Create StatefulSet with that specific tag</li> <li>Continue monitoring for newer versions</li> </ol>"},{"location":"configuration/update-strategies/#for-pin-strategy","title":"For <code>pin</code> Strategy","text":"<ol> <li>Validate <code>version</code> is specified</li> <li>Find latest build for that version</li> <li>Create StatefulSet with <code>version-latestBuild</code></li> <li>Monitor for new builds of the pinned version</li> </ol>"},{"location":"configuration/update-strategies/#for-build-pin-strategy","title":"For <code>build-pin</code> Strategy","text":"<ol> <li>Validate both <code>version</code> and <code>build</code> are specified</li> <li>Verify the version-build combination exists</li> <li>Create StatefulSet with exact tag <code>version-build</code></li> <li>No further version changes without spec updates</li> </ol>"},{"location":"configuration/update-strategies/#important-notes","title":"Important Notes","text":""},{"location":"configuration/update-strategies/#docker-tag-resolution","title":"Docker Tag Resolution","text":"<p>The operator NEVER uses the <code>:latest</code> Docker tag. All strategies resolve to concrete version-build combinations:</p> <ul> <li><code>latest</code> strategy \u2192 <code>lexfrei/papermc:1.21.1-91</code> (highest available)</li> <li><code>auto</code> strategy \u2192 <code>lexfrei/papermc:1.21.1-91</code> (solver result)</li> <li><code>pin</code> strategy \u2192 <code>lexfrei/papermc:1.21.1-95</code> (pinned version, latest build)</li> <li><code>build-pin</code> strategy \u2192 <code>lexfrei/papermc:1.21.1-91</code> (exact specification)</li> </ul> <p>This ensures reproducibility and prevents unexpected changes.</p>"},{"location":"configuration/update-strategies/#compatibility-validation","title":"Compatibility Validation","text":"<p>The operator validates compatibility using metadata from plugin repositories:</p> <ul> <li>Plugin versions declare supported Minecraft versions (e.g., \"1.20.x\", \"1.21.x\")</li> <li>Operator matches Paper version against these ranges</li> <li>If metadata is unavailable, <code>compatibilityOverride</code> can provide manual constraints</li> </ul>"},{"location":"configuration/update-strategies/#update-blocking","title":"Update Blocking","text":"<p>When the solver cannot find a compatible solution:</p> <ul> <li>Updates are blocked</li> <li><code>status.updateBlocked</code> indicates the reason</li> <li>Status shows which plugin is blocking and why</li> <li>Operator waits until constraints can be satisfied</li> </ul> <p>Example blocked status:</p> <pre><code>status:\n  updateBlocked:\n    blocked: true\n    reason: \"No compatible Paper version found for all plugins\"\n    blockedBy:\n      plugin: \"essentialsx\"\n      version: \"2.20.1\"\n      supportedVersions: [\"1.20.4\", \"1.21.1\"]\n</code></pre>"},{"location":"configuration/update-strategies/#maintenance-windows","title":"Maintenance Windows","text":"<p>Updates only occur during configured maintenance windows:</p> <pre><code>updateSchedule:\n  checkCron: \"0 3 * * *\"        # Check daily at 3 AM\n  maintenanceWindow:\n    enabled: true\n    cron: \"0 4 * * 0\"           # Apply Sundays at 4 AM\n</code></pre> <ul> <li><code>checkCron</code>: When to run the solver and discover new versions</li> <li><code>maintenanceWindow.cron</code>: When to actually apply updates</li> <li>Allows discovery without immediate application</li> </ul>"},{"location":"configuration/update-strategies/#graceful-shutdown","title":"Graceful Shutdown","text":"<p>All updates use graceful shutdown via RCON:</p> <ol> <li>Operator sends warning messages to players via RCON <code>say</code> commands (with intervals)</li> <li>Operator sends RCON <code>save-all</code> command</li> <li>Wait for save to complete</li> <li>Operator sends RCON <code>stop</code> command</li> <li>Paper saves world, unloads plugins, shuts down cleanly</li> <li>Pod terminates</li> <li>StatefulSet recreates pod with new image</li> <li>Paper starts with updated version/plugins</li> </ol> <p>This prevents world corruption and data loss.</p>"},{"location":"configuration/update-strategies/#troubleshooting","title":"Troubleshooting","text":""},{"location":"configuration/update-strategies/#update-not-happening","title":"Update Not Happening","text":"<p>Check:</p> <ol> <li>Is maintenance window enabled? (<code>maintenanceWindow.enabled: true</code>)</li> <li>Has the maintenance window cron triggered? (Check current time vs cron schedule)</li> <li>Is <code>updateDelay</code> blocking? (Check <code>status.availableUpdate.foundAt</code> + delay)</li> <li>Are updates blocked? (Check <code>status.updateBlocked</code>)</li> </ol>"},{"location":"configuration/update-strategies/#incompatible-plugin-version","title":"Incompatible Plugin Version","text":"<p>Solution:</p> <ol> <li>Check <code>status.plugins</code> for compatibility status</li> <li>Use <code>compatibilityOverride</code> if metadata is incorrect</li> <li>Consider pinning the plugin to a compatible version</li> <li>Report missing metadata to plugin maintainer</li> </ol>"},{"location":"configuration/update-strategies/#unexpected-version","title":"Unexpected Version","text":"<p>Check:</p> <ol> <li>Verify <code>updateStrategy</code> is what you expect</li> <li>Check <code>status.desiredVersion</code> vs <code>status.currentVersion</code></li> <li>Review solver logic in <code>status.availableUpdate</code></li> <li>Ensure <code>updateDelay</code> is configured correctly</li> </ol>"},{"location":"configuration/update-strategies/#rollback-needed","title":"Rollback Needed","text":"<p>The operator does not perform downgrades by default. To rollback:</p> <pre><code># Change to build-pin strategy with old version\nkubectl patch papermcserver my-server --type=merge \\\n  -p '{\"spec\":{\"updateStrategy\":\"build-pin\",\"version\":\"1.21.1\",\"build\":91}}'\n</code></pre> <p>Rollbacks require manual intervention for safety.</p>"},{"location":"configuration/update-strategies/#further-reading","title":"Further Reading","text":"<ul> <li>Architecture - Detailed architectural design</li> <li>Constraint Solver - How version compatibility is resolved</li> <li>PaperMCServer Reference - Full PaperMCServer CRD specification</li> <li>Plugin Reference - Full Plugin CRD specification</li> </ul>"},{"location":"development/","title":"Development","text":"<p>This section covers development setup and contribution guidelines.</p>"},{"location":"development/#overview","title":"Overview","text":"<p>Minecraft Operator is built with:</p> <ul> <li>Go 1.26+ \u2014 Primary language</li> <li>controller-runtime \u2014 Kubernetes operator framework</li> <li>Kubebuilder v4 \u2014 Project scaffolding</li> <li>Helm \u2014 Deployment charts</li> </ul>"},{"location":"development/#sections","title":"Sections","text":"<ul> <li> <p> Setup</p> <p>Development environment setup</p> <p> Setup</p> </li> <li> <p> Contributing</p> <p>Contribution guidelines and workflow</p> <p> Contributing</p> </li> </ul>"},{"location":"development/#quick-start","title":"Quick Start","text":"<pre><code># Clone repository\ngit clone https://github.com/lexfrei/minecraft-operator.git\ncd minecraft-operator\n\n# Install dependencies\nmake manifests generate\n\n# Run tests\nmake test\n\n# Run linter\nmake lint\n\n# Run locally\nmake run\n</code></pre>"},{"location":"development/#project-structure","title":"Project Structure","text":"<pre><code>minecraft-operator/\n\u251c\u2500\u2500 api/v1beta1/           # CRD type definitions\n\u251c\u2500\u2500 internal/\n\u2502   \u251c\u2500\u2500 controller/         # Controller implementations\n\u2502   \u2514\u2500\u2500 crdmanager/crds/    # Embedded CRDs (controller-gen output)\n\u251c\u2500\u2500 pkg/                    # Shared packages\n\u2502   \u251c\u2500\u2500 solver/             # Constraint solver\n\u2502   \u251c\u2500\u2500 plugins/            # Plugin API clients\n\u2502   \u251c\u2500\u2500 rcon/               # RCON client\n\u2502   \u251c\u2500\u2500 registry/           # Docker Hub client\n\u2502   \u251c\u2500\u2500 testutil/           # Test mocks and helpers\n\u2502   \u2514\u2500\u2500 webui/              # Web UI\n\u251c\u2500\u2500 charts/\n\u2502   \u2514\u2500\u2500 minecraft-operator/ # Helm chart\n\u251c\u2500\u2500 cmd/main.go             # Entrypoint\n\u2514\u2500\u2500 Makefile                # Build automation\n</code></pre>"},{"location":"development/#key-files","title":"Key Files","text":"File Purpose <code>api/v1beta1/*_types.go</code> CRD definitions <code>internal/controller/*_controller.go</code> Reconciliation logic <code>.architecture.yaml</code> Technical decisions (ADRs) <code>CLAUDE.md</code> Development standards"},{"location":"development/#testing","title":"Testing","text":"<p>The project uses multiple testing strategies:</p> Type Command Description Unit <code>make test</code> Controller and package tests with envtest Helm <code>helm unittest charts/minecraft-operator</code> Chart template validation E2E <code>make test-e2e</code> Full cluster tests (Kind) Lint <code>make lint</code> Code quality checks"},{"location":"development/#tdd-workflow","title":"TDD Workflow","text":"<p>This project follows strict TDD:</p> <ol> <li>Write failing test</li> <li>Implement minimal code</li> <li>Run test \u2192 pass</li> <li>Refactor</li> <li>Repeat</li> </ol> <p>See CLAUDE.md for detailed standards.</p>"},{"location":"development/#see-also","title":"See Also","text":"<ul> <li>Setup \u2014 Development environment</li> <li>Contributing \u2014 Contribution workflow</li> <li>Architecture \u2014 System design</li> </ul>"},{"location":"development/contributing/","title":"Contributing","text":"<p>Guidelines for contributing to Minecraft Operator.</p>"},{"location":"development/contributing/#getting-started","title":"Getting Started","text":"<ol> <li>Fork the repository</li> <li>Clone your fork</li> <li>Set up development environment (see Setup)</li> <li>Create a feature branch</li> <li>Make changes</li> <li>Submit a pull request</li> </ol>"},{"location":"development/contributing/#workflow","title":"Workflow","text":""},{"location":"development/contributing/#branch-naming","title":"Branch Naming","text":"<p>Use descriptive branch names:</p> <pre><code>feat/modrinth-support\nfix/rcon-timeout\ndocs/update-strategies\nrefactor/solver-algorithm\n</code></pre>"},{"location":"development/contributing/#commit-messages","title":"Commit Messages","text":"<p>Use semantic commit format:</p> <pre><code>type(scope): brief description\n\nOptional longer explanation.\n\nCo-Authored-By: Your Name &lt;email@example.com&gt;\n</code></pre> <p>Types:</p> Type Description <code>feat</code> New features <code>fix</code> Bug fixes <code>docs</code> Documentation <code>refactor</code> Code refactoring <code>test</code> Test changes <code>chore</code> Maintenance <code>ci</code> CI/CD changes <p>Example:</p> <pre><code>feat(plugins): add Modrinth source support\n\nImplement Modrinth API client for fetching plugin metadata.\nSupports version filtering by Minecraft version compatibility.\n\nCo-Authored-By: Developer &lt;dev@example.com&gt;\n</code></pre>"},{"location":"development/contributing/#pull-requests","title":"Pull Requests","text":"<ol> <li>Create draft PR initially</li> <li>Fill template completely</li> <li>Request review when ready</li> <li>Address feedback</li> <li>Squash merge when approved</li> </ol>"},{"location":"development/contributing/#code-standards","title":"Code Standards","text":""},{"location":"development/contributing/#go-code","title":"Go Code","text":"<ul> <li>Follow Effective Go</li> <li>Use <code>gofmt</code> formatting</li> <li>Pass <code>golangci-lint</code> without errors</li> <li>Add tests for new code</li> </ul>"},{"location":"development/contributing/#testing","title":"Testing","text":"<p>TDD is mandatory:</p> <ol> <li>Write failing test first</li> <li>Implement minimal code</li> <li>Pass test</li> <li>Refactor</li> </ol> <pre><code>func TestSolverFindsCompatibleVersion(t *testing.T) {\n    // 1. Write test first\n    solver := NewSimpleSolver()\n    result, err := solver.Solve(plugins, servers)\n\n    require.NoError(t, err)\n    assert.Equal(t, \"1.21.1\", result.PaperVersion)\n}\n</code></pre>"},{"location":"development/contributing/#logging","title":"Logging","text":"<p>Use <code>log/slog</code> with constant messages:</p> <pre><code>// Good\nslog.InfoContext(ctx, \"Update available\", \"version\", version)\n\n// Bad - variable in message\nslog.InfoContext(ctx, fmt.Sprintf(\"Update to %s available\", version))\n</code></pre>"},{"location":"development/contributing/#review-checklist","title":"Review Checklist","text":"<p>Before submitting:</p> <ul> <li> Tests pass: <code>make test</code></li> <li> Helm chart tests pass: <code>helm unittest charts/minecraft-operator</code></li> <li> Linter passes: <code>make lint</code></li> <li> Code generated: <code>make manifests generate</code></li> <li> Documentation updated</li> <li> Commits signed off</li> </ul>"},{"location":"development/contributing/#areas-for-contribution","title":"Areas for Contribution","text":""},{"location":"development/contributing/#high-priority","title":"High Priority","text":"<ul> <li>Modrinth plugin source support</li> <li>Documentation improvements</li> <li>Plugin E2E tests \u2014 requires mock Hangar server in-cluster</li> </ul>"},{"location":"development/contributing/#medium-priority","title":"Medium Priority","text":"<ul> <li>Prometheus metrics</li> <li>Web UI enhancements</li> <li>Spigot plugin source support</li> </ul>"},{"location":"development/contributing/#good-first-issues","title":"Good First Issues","text":"<p>Check GitHub Issues for beginner-friendly tasks.</p>"},{"location":"development/contributing/#code-of-conduct","title":"Code of Conduct","text":"<p>Be respectful and constructive in all interactions.</p>"},{"location":"development/contributing/#license","title":"License","text":"<p>By contributing, you agree your code will be licensed under BSD-3-Clause.</p>"},{"location":"development/contributing/#see-also","title":"See Also","text":"<ul> <li>Setup \u2014 Development environment</li> <li>Architecture \u2014 System design</li> <li>GitHub Issues \u2014 Open tasks</li> </ul>"},{"location":"development/setup/","title":"Development Setup","text":"<p>Set up your local development environment for Minecraft Operator.</p>"},{"location":"development/setup/#prerequisites","title":"Prerequisites","text":"Tool Version Purpose Go 1.26+ Language runtime Podman or Docker Latest Container builds Helm 3.14+ Chart testing kubectl 1.27+ Cluster access Kind Latest Local Kubernetes (optional)"},{"location":"development/setup/#install-go","title":"Install Go","text":"macOSLinux <pre><code>brew install go\n</code></pre> <pre><code>wget https://go.dev/dl/go1.26.linux-amd64.tar.gz\nsudo tar -C /usr/local -xzf go1.26.linux-amd64.tar.gz\nexport PATH=$PATH:/usr/local/go/bin\n</code></pre>"},{"location":"development/setup/#install-tools","title":"Install Tools","text":"<pre><code># Helm\nbrew install helm  # or follow helm.sh/docs/intro/install\n\n# kubectl\nbrew install kubectl  # or kubernetes.io/docs/tasks/tools\n\n# Kind (for local cluster)\nbrew install kind  # or kind.sigs.k8s.io/docs/user/quick-start\n</code></pre>"},{"location":"development/setup/#clone-repository","title":"Clone Repository","text":"<pre><code>git clone https://github.com/lexfrei/minecraft-operator.git\ncd minecraft-operator\n</code></pre>"},{"location":"development/setup/#generate-code","title":"Generate Code","text":"<p>After modifying CRD types in <code>api/v1beta1/</code>, regenerate code:</p> <pre><code># Generate CRDs and DeepCopy methods\nmake manifests generate\n\n# Format code\nmake fmt\n\n# Run vet\nmake vet\n</code></pre>"},{"location":"development/setup/#run-tests","title":"Run Tests","text":"<pre><code># Unit tests with envtest\nmake test\n\n# Helm chart template tests\nhelm unittest charts/minecraft-operator\n\n# E2E tests (creates Kind cluster)\nmake test-e2e\n</code></pre>"},{"location":"development/setup/#test-coverage","title":"Test Coverage","text":"<pre><code># Run tests with coverage\nmake test\n\n# View coverage report\ngo tool cover -html=cover.out\n\n# Check controller coverage (target: 60%+)\ngo test ./internal/controller/... -coverprofile=cover.out \\\n  &amp;&amp; go tool cover -func=cover.out | grep total\n</code></pre>"},{"location":"development/setup/#helm-chart-tests","title":"Helm Chart Tests","text":"<p>The operator Helm chart uses helm-unittest for template validation:</p> <pre><code># Install plugin\nhelm plugin install https://github.com/helm-unittest/helm-unittest\n\n# Run chart tests\nhelm unittest charts/minecraft-operator\n</code></pre> <p>Test suites cover deployment, RBAC, service account, metrics service, and WebUI templates. Tests live in <code>charts/minecraft-operator/tests/</code>.</p>"},{"location":"development/setup/#run-linter","title":"Run Linter","text":"<pre><code># Check for issues\nmake lint\n\n# Auto-fix where possible\nmake lint-fix\n\n# Verify config\nmake lint-config\n</code></pre> <p>All Errors Required</p> <p>ALL linting errors must be fixed before commit. No exceptions for \"cosmetic\" issues.</p>"},{"location":"development/setup/#run-locally","title":"Run Locally","text":"<p>Run the operator against your current kubeconfig cluster:</p> <pre><code># Default: JSON logs, Info level\nmake run\n\n# Development: Text logs, Debug level\nmake run ARGS=\"--log-level=debug --log-format=text\"\n</code></pre> <p>The operator will reconcile resources in your cluster.</p>"},{"location":"development/setup/#build-container","title":"Build Container","text":"<pre><code># Build with Podman\nmake container-build IMG=ghcr.io/lexfrei/minecraft-operator:dev\n\n# Push to registry\nmake container-push IMG=ghcr.io/lexfrei/minecraft-operator:dev\n</code></pre>"},{"location":"development/setup/#local-cluster-kind","title":"Local Cluster (Kind)","text":"<p>Create a local Kubernetes cluster:</p> <pre><code># Create cluster\nkind create cluster --name minecraft-dev\n\n# Run operator locally (CRDs are applied automatically at startup)\nmake run\n</code></pre>"},{"location":"development/setup/#helm-development","title":"Helm Development","text":""},{"location":"development/setup/#test-charts","title":"Test Charts","text":"<pre><code># Run template tests\nhelm unittest charts/minecraft-operator\n</code></pre>"},{"location":"development/setup/#lint-charts","title":"Lint Charts","text":"<pre><code>helm lint charts/minecraft-operator\n</code></pre>"},{"location":"development/setup/#template-charts","title":"Template Charts","text":"<pre><code># See generated manifests\nhelm template minecraft-operator charts/minecraft-operator \\\n  --namespace minecraft-operator-system\n\n# With custom values\nhelm template minecraft-operator charts/minecraft-operator \\\n  --set replicaCount=2\n</code></pre>"},{"location":"development/setup/#install-chart","title":"Install Chart","text":"<pre><code># Install operator (CRDs are embedded and applied at startup)\nhelm install minecraft-operator charts/minecraft-operator \\\n  --create-namespace --namespace minecraft-operator-system \\\n  --set image.repository=ghcr.io/lexfrei/minecraft-operator \\\n  --set image.tag=dev\n</code></pre>"},{"location":"development/setup/#ide-setup","title":"IDE Setup","text":""},{"location":"development/setup/#vs-code","title":"VS Code","text":"<p>Recommended extensions:</p> <ul> <li>Go (golang.go)</li> <li>YAML (redhat.vscode-yaml)</li> <li>Kubernetes (ms-kubernetes-tools.vscode-kubernetes-tools)</li> </ul>"},{"location":"development/setup/#goland","title":"GoLand","text":"<p>Enable:</p> <ul> <li>Go Modules integration</li> <li>gofmt on save</li> <li>golangci-lint integration</li> </ul>"},{"location":"development/setup/#environment-variables","title":"Environment Variables","text":"Variable Description Default <code>KUBECONFIG</code> Kubernetes config path <code>~/.kube/config</code> <code>ENABLE_WEBHOOKS</code> Enable admission webhooks <code>false</code> <code>LOG_LEVEL</code> Logging level <code>info</code> <code>LOG_FORMAT</code> Log format (json/text) <code>json</code>"},{"location":"development/setup/#makefile-targets","title":"Makefile Targets","text":"Target Description <code>make manifests</code> Generate CRDs to internal/crdmanager/crds/ <code>make generate</code> Generate DeepCopy methods <code>make fmt</code> Run go fmt <code>make vet</code> Run go vet <code>make test</code> Run unit tests <code>make test-e2e</code> Run E2E tests (Kind cluster) <code>helm unittest charts/minecraft-operator</code> Run Helm chart template tests <code>make lint</code> Run golangci-lint <code>make lint-fix</code> Auto-fix lint issues <code>make build</code> Build binary to bin/manager <code>make run</code> Run operator locally <code>make container-build</code> Build container image <code>make container-push</code> Push container image"},{"location":"development/setup/#troubleshooting","title":"Troubleshooting","text":""},{"location":"development/setup/#envtest-not-working","title":"envtest Not Working","text":"<pre><code># Install envtest binaries manually\nmake envtest\n./bin/setup-envtest use 1.34.x\n</code></pre>"},{"location":"development/setup/#golangci-lint-outdated","title":"golangci-lint Outdated","text":"<pre><code># Update linter\nmake golangci-lint\n./bin/golangci-lint --version\n</code></pre>"},{"location":"development/setup/#kind-cluster-issues","title":"Kind Cluster Issues","text":"<pre><code># Delete and recreate\nkind delete cluster --name minecraft-dev\nkind create cluster --name minecraft-dev\n</code></pre>"},{"location":"development/setup/#see-also","title":"See Also","text":"<ul> <li>Contributing \u2014 Contribution workflow</li> <li>CLAUDE.md \u2014 Full development standards</li> </ul>"},{"location":"getting-started/","title":"Getting Started","text":"<p>Welcome to Minecraft Operator! This section will guide you through setting up the operator and creating your first Minecraft server.</p>"},{"location":"getting-started/#overview","title":"Overview","text":"<p>The Minecraft Operator manages PaperMC servers in Kubernetes with:</p> <ul> <li>Automatic version updates for Paper and plugins</li> <li>Compatibility solving between plugins and server versions</li> <li>Scheduled maintenance windows with graceful shutdown</li> <li>Declarative configuration via Custom Resources</li> </ul>"},{"location":"getting-started/#sections","title":"Sections","text":"<ul> <li> <p> Prerequisites</p> <p>Required tools and Kubernetes cluster setup</p> <p> Check prerequisites</p> </li> <li> <p> Installation</p> <p>Install the operator using Helm</p> <p> Install</p> </li> <li> <p> Quick Start</p> <p>Create your first server and add plugins</p> <p> Get started</p> </li> </ul>"},{"location":"getting-started/#what-youll-learn","title":"What You'll Learn","text":"<ol> <li>Prerequisites \u2014 Kubernetes and Helm version requirements</li> <li>Installation \u2014 How to install CRDs and the operator via Helm</li> <li>Quick Start \u2014 Create a PaperMCServer and add plugins</li> </ol>"},{"location":"getting-started/#next-steps","title":"Next Steps","text":"<p>After completing this guide, explore:</p> <ul> <li>Configuration \u2014 Detailed CRD reference</li> <li>Update Strategies \u2014 Version management options</li> <li>Architecture \u2014 How the operator works</li> </ul>"},{"location":"getting-started/installation/","title":"Installation","text":"<p>Install Minecraft Operator using the Helm chart from the GitHub Container Registry.</p>"},{"location":"getting-started/installation/#install-operator","title":"Install Operator","text":"<p>A single Helm install deploys a fully working operator. CRDs are embedded in the operator binary and applied automatically at startup via server-side apply.</p> <pre><code>helm install minecraft-operator \\\n  oci://ghcr.io/lexfrei/minecraft-operator \\\n  --namespace minecraft-operator-system \\\n  --create-namespace\n</code></pre> <p>Embedded CRDs</p> <p>CRDs (PaperMCServer, Plugin) are embedded in the operator binary and applied at startup using server-side apply. This is required because the PaperMCServer CRD exceeds the 262KB annotation limit for client-side apply. The Helm value <code>crds.manage</code> (default: <code>true</code>) controls whether the operator manages CRDs.</p>"},{"location":"getting-started/installation/#verify-installation","title":"Verify Installation","text":"<p>Check that the operator is running:</p> <pre><code>kubectl get pods --namespace minecraft-operator-system\n</code></pre> <p>Expected output:</p> <pre><code>NAME                                  READY   STATUS    RESTARTS   AGE\nminecraft-operator-xxxxxxxxxx-xxxxx   1/1     Running   0          30s\n</code></pre>"},{"location":"getting-started/installation/#configuration-options","title":"Configuration Options","text":""},{"location":"getting-started/installation/#common-values","title":"Common Values","text":"Value Description Default <code>replicaCount</code> Number of operator replicas <code>1</code> <code>image.repository</code> Container image <code>ghcr.io/lexfrei/minecraft-operator</code> <code>image.tag</code> Image tag Chart appVersion <code>resources.requests.memory</code> Memory request <code>128Mi</code> <code>resources.limits.memory</code> Memory limit <code>256Mi</code> <code>webui.enabled</code> Enable Web UI <code>true</code> <code>webui.port</code> Web UI port <code>8082</code>"},{"location":"getting-started/installation/#custom-values-file","title":"Custom Values File","text":"<p>Create a <code>values.yaml</code> for customization:</p> <pre><code>replicaCount: 1\n\nresources:\n  requests:\n    cpu: 100m\n    memory: 128Mi\n  limits:\n    memory: 256Mi\n\nwebui:\n  enabled: true\n  port: 8082\n\n# Leader election for HA (if running multiple replicas)\nleaderElection:\n  enabled: true\n</code></pre> <p>Install with custom values:</p> <pre><code>helm install minecraft-operator \\\n  oci://ghcr.io/lexfrei/minecraft-operator \\\n  --namespace minecraft-operator-system \\\n  --values values.yaml\n</code></pre>"},{"location":"getting-started/installation/#upgrade","title":"Upgrade","text":"<p>Upgrade the operator to a new version:</p> <pre><code>helm upgrade minecraft-operator \\\n  oci://ghcr.io/lexfrei/minecraft-operator \\\n  --namespace minecraft-operator-system\n</code></pre> <p>CRDs are automatically updated at operator startup via server-side apply.</p>"},{"location":"getting-started/installation/#uninstall","title":"Uninstall","text":"<p>Remove the operator:</p> <pre><code>helm uninstall minecraft-operator --namespace minecraft-operator-system\n</code></pre> <p>CRDs are NOT automatically removed (Kubernetes safety). To remove them manually:</p> <pre><code># WARNING: deletes all PaperMCServer and Plugin custom resources!\nkubectl delete crd papermcservers.mc.k8s.lex.la plugins.mc.k8s.lex.la\n</code></pre> <p>Data Loss Warning</p> <p>Deleting CRDs will delete all custom resources (PaperMCServer, Plugin). Minecraft world data on PVCs is NOT deleted automatically.</p>"},{"location":"getting-started/installation/#next-steps","title":"Next Steps","text":"<p>Proceed to Quick Start to create your first Minecraft server.</p>"},{"location":"getting-started/prerequisites/","title":"Prerequisites","text":"<p>Before installing Minecraft Operator, ensure your environment meets these requirements.</p>"},{"location":"getting-started/prerequisites/#kubernetes-cluster","title":"Kubernetes Cluster","text":"Requirement Minimum Version Kubernetes 1.27+ kubectl 1.27+ <p>The operator uses features available in Kubernetes 1.27 and later:</p> <ul> <li>StatefulSets with stable network identities</li> <li>Custom Resource Definitions (CRDs)</li> <li>RBAC for controller permissions</li> </ul>"},{"location":"getting-started/prerequisites/#helm","title":"Helm","text":"Requirement Minimum Version Helm 3.14+ <p>Helm 3.14+ is required for OCI registry support used by the operator charts.</p>"},{"location":"getting-started/prerequisites/#install-helm","title":"Install Helm","text":"macOSLinuxWindows <pre><code>brew install helm\n</code></pre> <pre><code>curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash\n</code></pre> <pre><code>choco install kubernetes-helm\n</code></pre>"},{"location":"getting-started/prerequisites/#verify-installation","title":"Verify Installation","text":"<pre><code>helm version\n# version.BuildInfo{Version:\"v3.14.0\", ...}\n</code></pre>"},{"location":"getting-started/prerequisites/#storage","title":"Storage","text":"<p>The operator creates StatefulSets with PersistentVolumeClaims for Minecraft world data.</p> <p>Storage Class Required</p> <p>Ensure your cluster has a default StorageClass or specify one in the PaperMCServer spec.</p> <pre><code># Check available storage classes\nkubectl get storageclass\n</code></pre>"},{"location":"getting-started/prerequisites/#optional-container-runtime","title":"Optional: Container Runtime","text":"<p>If you plan to build custom images or run the operator locally:</p> Tool Purpose Podman or Docker Container image builds Go 1.26+ Local development"},{"location":"getting-started/prerequisites/#network-requirements","title":"Network Requirements","text":"<p>The operator needs to access:</p> Endpoint Purpose <code>hub.docker.com</code> Pull Paper server images <code>hangar.papermc.io</code> Plugin metadata and downloads <code>api.modrinth.com</code> (Future) Modrinth plugin support <p>Ensure your cluster has outbound internet access or configure a proxy.</p>"},{"location":"getting-started/prerequisites/#next-steps","title":"Next Steps","text":"<p>Once prerequisites are met, proceed to Installation.</p>"},{"location":"getting-started/quickstart/","title":"Quick Start","text":"<p>Create your first Minecraft server with plugins using Minecraft Operator.</p>"},{"location":"getting-started/quickstart/#create-a-namespace","title":"Create a Namespace","text":"<p>Create a namespace for your Minecraft server:</p> <pre><code>kubectl create namespace minecraft\n</code></pre>"},{"location":"getting-started/quickstart/#create-rcon-secret","title":"Create RCON Secret","text":"<p>Create a secret for RCON password (used for graceful shutdown):</p> <pre><code>kubectl create secret generic my-server-rcon \\\n  --namespace minecraft \\\n  --from-literal=password=your-secure-password\n</code></pre>"},{"location":"getting-started/quickstart/#create-a-papermcserver","title":"Create a PaperMCServer","text":"<p>Create a file <code>my-server.yaml</code>:</p> <pre><code>apiVersion: mc.k8s.lex.la/v1beta1\nkind: PaperMCServer\nmetadata:\n  name: my-server\n  namespace: minecraft\n  labels:\n    environment: production\nspec:\n  # Use constraint solver to pick best version for plugins\n  updateStrategy: \"auto\"\n\n  # Check for updates daily, apply on Sundays\n  updateSchedule:\n    checkCron: \"0 3 * * *\"\n    maintenanceWindow:\n      enabled: true\n      cron: \"0 4 * * 0\"\n\n  # Graceful shutdown via RCON\n  gracefulShutdown:\n    timeout: 300s\n  rcon:\n    enabled: true\n    passwordSecret:\n      name: my-server-rcon\n      key: password\n\n  # Pod resources\n  podTemplate:\n    spec:\n      containers:\n        - name: minecraft\n          resources:\n            requests:\n              memory: \"2Gi\"\n            limits:\n              memory: \"4Gi\"\n</code></pre> <p>Apply the manifest:</p> <pre><code>kubectl apply --filename my-server.yaml\n</code></pre>"},{"location":"getting-started/quickstart/#verify-server-creation","title":"Verify Server Creation","text":"<p>Check the PaperMCServer status:</p> <pre><code>kubectl get papermcserver --namespace minecraft\n</code></pre> <p>Expected output:</p> <pre><code>NAME        VERSION   BUILD   STATUS   AGE\nmy-server   1.21.4    125     Ready    2m\n</code></pre> <p>Check the created resources:</p> <pre><code># StatefulSet\nkubectl get statefulset my-server --namespace minecraft\n\n# Pod\nkubectl get pods --namespace minecraft\n\n# Service\nkubectl get svc my-server --namespace minecraft\n</code></pre>"},{"location":"getting-started/quickstart/#add-a-plugin","title":"Add a Plugin","text":"<p>Create a file <code>essentials-plugin.yaml</code>:</p> <pre><code>apiVersion: mc.k8s.lex.la/v1beta1\nkind: Plugin\nmetadata:\n  name: essentialsx\n  namespace: minecraft\nspec:\n  source:\n    type: hangar\n    project: \"EssentialsX/Essentials\"\n\n  # Always use latest compatible version\n  updateStrategy: \"latest\"\n\n  # Match servers with environment=production label\n  instanceSelector:\n    matchLabels:\n      environment: production\n</code></pre> <p>Apply the plugin:</p> <pre><code>kubectl apply --filename essentials-plugin.yaml\n</code></pre>"},{"location":"getting-started/quickstart/#verify-plugin","title":"Verify Plugin","text":"<p>Check the Plugin status:</p> <pre><code>kubectl get plugin --namespace minecraft\n</code></pre> <p>Expected output:</p> <pre><code>NAME          SOURCE   VERSION   MATCHED   STATUS\nessentialsx   hangar   2.21.0    1         Ready\n</code></pre> <p>The plugin will be downloaded and installed during the next maintenance window, or immediately if you restart the server.</p>"},{"location":"getting-started/quickstart/#connect-to-your-server","title":"Connect to Your Server","text":"<p>Get the server's external IP or use port-forward:</p> <pre><code># Port forward for local testing\nkubectl port-forward svc/my-server 25565:25565 --namespace minecraft\n</code></pre> <p>Connect with your Minecraft client to <code>localhost:25565</code>.</p>"},{"location":"getting-started/quickstart/#view-logs","title":"View Logs","text":"<p>Check server logs:</p> <pre><code>kubectl logs statefulset/my-server --namespace minecraft --follow\n</code></pre>"},{"location":"getting-started/quickstart/#access-web-ui","title":"Access Web UI","text":"<p>If Web UI is enabled, port-forward to view the dashboard:</p> <pre><code>kubectl port-forward svc/minecraft-operator-webui 8082:8082 \\\n  --namespace minecraft-operator-system\n</code></pre> <p>Open http://localhost:8082/ui in your browser.</p>"},{"location":"getting-started/quickstart/#next-steps","title":"Next Steps","text":"<ul> <li>Configuration \u2014 Learn about all CRD options</li> <li>Update Strategies \u2014 Understand version management</li> <li>Troubleshooting \u2014 Common issues and solutions</li> </ul>"},{"location":"operations/","title":"Operations","text":"<p>This section covers day-to-day operations for running Minecraft servers with the operator.</p>"},{"location":"operations/#overview","title":"Overview","text":"<p>The Minecraft Operator automates most operational tasks:</p> <ul> <li>Version updates during maintenance windows</li> <li>Plugin compatibility resolution</li> <li>Graceful server shutdown</li> </ul> <p>However, some situations require manual intervention.</p>"},{"location":"operations/#sections","title":"Sections","text":"<ul> <li> <p> Troubleshooting</p> <p>Common issues and how to resolve them</p> <p> Troubleshoot</p> </li> </ul>"},{"location":"operations/#common-operations","title":"Common Operations","text":""},{"location":"operations/#check-server-status","title":"Check Server Status","text":"<pre><code>kubectl get papermcserver --namespace minecraft\n</code></pre> <pre><code>NAME        VERSION   BUILD   STATUS   AGE\nsurvival    1.21.4    125     Ready    7d\ncreative    1.20.6    89      Ready    14d\n</code></pre>"},{"location":"operations/#check-plugin-status","title":"Check Plugin Status","text":"<pre><code>kubectl get plugin --namespace minecraft\n</code></pre> <pre><code>NAME          SOURCE   VERSION   MATCHED   STATUS\nessentialsx   hangar   2.21.0    2         Ready\nbluemap       hangar   5.4.0     1         Ready\n</code></pre>"},{"location":"operations/#view-server-logs","title":"View Server Logs","text":"<pre><code>kubectl logs statefulset/survival --namespace minecraft --follow\n</code></pre>"},{"location":"operations/#force-update-check","title":"Force Update Check","text":"<p>Delete the server pod to trigger immediate reconciliation:</p> <pre><code>kubectl delete pod survival-0 --namespace minecraft\n</code></pre> <p>World Data</p> <p>Deleting the pod is safe - world data is stored on PVC. The server will restart with the same data.</p>"},{"location":"operations/#manual-rcon-access","title":"Manual RCON Access","text":"<p>Port-forward to RCON port:</p> <pre><code>kubectl port-forward statefulset/survival 25575:25575 --namespace minecraft\n</code></pre> <p>Connect with an RCON client:</p> <pre><code># Using mcrcon\nmcrcon -H localhost -P 25575 -p your-password \"list\"\n</code></pre>"},{"location":"operations/#access-web-ui","title":"Access Web UI","text":"<pre><code>kubectl port-forward svc/minecraft-operator-webui 8082:8082 \\\n  --namespace minecraft-operator-system\n</code></pre> <p>Open http://localhost:8082/ui</p>"},{"location":"operations/#maintenance-tasks","title":"Maintenance Tasks","text":""},{"location":"operations/#backup-world-data","title":"Backup World Data","text":"<p>World data is stored on PVCs. Back up using your preferred method:</p> <pre><code># Example: Copy to local machine\nkubectl cp minecraft/survival-0:/data/world ./backup/world\n</code></pre> <p>Scheduled Backups</p> <p>Consider using Velero or similar tools for scheduled PVC backups.</p>"},{"location":"operations/#scale-down-for-maintenance","title":"Scale Down for Maintenance","text":"<pre><code># Scale down (stops the server)\nkubectl scale statefulset survival --replicas=0 --namespace minecraft\n\n# Scale back up\nkubectl scale statefulset survival --replicas=1 --namespace minecraft\n</code></pre>"},{"location":"operations/#view-operator-logs","title":"View Operator Logs","text":"<pre><code>kubectl logs deployment/minecraft-operator \\\n  --namespace minecraft-operator-system \\\n  --follow\n</code></pre> <p>Filter by log level:</p> <pre><code># Errors only\nkubectl logs deployment/minecraft-operator \\\n  --namespace minecraft-operator-system | grep '\"level\":\"error\"'\n</code></pre>"},{"location":"operations/#monitoring","title":"Monitoring","text":""},{"location":"operations/#prometheus-metrics","title":"Prometheus Metrics","text":"<p>The operator exposes custom metrics at <code>/metrics</code> (port 8080):</p> Metric Type Description <code>minecraft_operator_reconcile_total</code> counter Reconciliations by controller <code>minecraft_operator_reconcile_errors_total</code> counter Failed reconciliations <code>minecraft_operator_reconcile_duration_seconds</code> histogram Reconciliation latency <code>minecraft_operator_plugin_api_requests_total</code> counter Plugin API requests by source <code>minecraft_operator_plugin_api_errors_total</code> counter Failed plugin API requests <code>minecraft_operator_plugin_api_duration_seconds</code> histogram Plugin API latency <code>minecraft_operator_solver_runs_total</code> counter Solver invocations by type <code>minecraft_operator_solver_errors_total</code> counter Failed solver invocations <code>minecraft_operator_solver_duration_seconds</code> histogram Solver latency <code>minecraft_operator_updates_total</code> counter Update attempts (success/failure) <p>Access metrics locally:</p> <pre><code>kubectl port-forward svc/minecraft-operator-controller-manager-metrics-service \\\n  8080:8080 --namespace minecraft-operator-system\ncurl --insecure https://localhost:8080/metrics\n</code></pre>"},{"location":"operations/#resource-status","title":"Resource Status","text":"<p>Check conditions on resources:</p> <pre><code>kubectl get papermcserver survival --namespace minecraft \\\n  --output jsonpath='{.status.conditions}'\n</code></pre>"},{"location":"operations/#update-status","title":"Update Status","text":"<p>Check for pending updates:</p> <pre><code>kubectl get papermcserver survival --namespace minecraft \\\n  --output jsonpath='{.status.availableUpdate}'\n</code></pre>"},{"location":"operations/#plugin-compatibility","title":"Plugin Compatibility","text":"<p>Check if updates are blocked:</p> <pre><code>kubectl get papermcserver survival --namespace minecraft \\\n  --output jsonpath='{.status.updateBlocked}'\n</code></pre>"},{"location":"operations/#see-also","title":"See Also","text":"<ul> <li>Troubleshooting \u2014 Common issues and solutions</li> <li>Configuration \u2014 CRD reference</li> </ul>"},{"location":"operations/troubleshooting/","title":"Troubleshooting","text":"<p>Common issues and their solutions when running Minecraft Operator.</p>"},{"location":"operations/troubleshooting/#server-issues","title":"Server Issues","text":""},{"location":"operations/troubleshooting/#server-not-starting","title":"Server Not Starting","text":"<p>Symptoms: Pod stuck in <code>Pending</code> or <code>CrashLoopBackOff</code></p> <p>Check pod status:</p> <pre><code>kubectl describe pod survival-0 --namespace minecraft\n</code></pre> <p>Common causes:</p> Insufficient ResourcesPVC Not BoundImage Pull Error <pre><code>Events:\n  Warning  FailedScheduling  Insufficient memory\n</code></pre> <p>Solution: Reduce memory requests or add nodes:</p> <pre><code>spec:\n  podTemplate:\n    spec:\n      containers:\n        - name: minecraft\n          resources:\n            requests:\n              memory: \"1Gi\"  # Reduce from 2Gi\n</code></pre> <pre><code>Events:\n  Warning  FailedMount  persistentvolumeclaim \"data-survival-0\" not found\n</code></pre> <p>Solution: Check StorageClass availability:</p> <pre><code>kubectl get storageclass\nkubectl get pvc --namespace minecraft\n</code></pre> <pre><code>Events:\n  Warning  Failed  Failed to pull image\n</code></pre> <p>Solution: Check image name and registry access:</p> <pre><code>kubectl get papermcserver survival --namespace minecraft \\\n  --output jsonpath='{.status.desiredVersion}'\n</code></pre>"},{"location":"operations/troubleshooting/#server-crashes-on-startup","title":"Server Crashes on Startup","text":"<p>Symptoms: Pod restarts repeatedly</p> <p>Check logs:</p> <pre><code>kubectl logs survival-0 --namespace minecraft --previous\n</code></pre> <p>Common causes:</p> Java Memory IssuesPlugin ConflictWorld Corruption <p>Look for <code>OutOfMemoryError</code> in logs.</p> <p>Solution: Increase memory limits:</p> <pre><code>spec:\n  podTemplate:\n    spec:\n      containers:\n        - name: minecraft\n          resources:\n            limits:\n              memory: \"4Gi\"  # Increase limit\n          env:\n            - name: JAVA_OPTS\n              value: \"-Xmx3G\"  # Max heap &lt; limit\n</code></pre> <p>Look for plugin errors in startup logs.</p> <p>Solution: Temporarily remove plugins:</p> <pre><code># Delete problematic plugin\nkubectl delete plugin problematic-plugin --namespace minecraft\n\n# Restart server\nkubectl delete pod survival-0 --namespace minecraft\n</code></pre> <p>Look for <code>RegionFileVersion</code> or chunk errors.</p> <p>Solution: Restore from backup or delete world:</p> <pre><code># DANGER: This deletes the world\nkubectl exec -it survival-0 --namespace minecraft -- rm -rf /data/world\nkubectl delete pod survival-0 --namespace minecraft\n</code></pre>"},{"location":"operations/troubleshooting/#plugin-issues","title":"Plugin Issues","text":""},{"location":"operations/troubleshooting/#plugin-not-installing","title":"Plugin Not Installing","text":"<p>Symptoms: Plugin shows <code>Ready</code> but not installed on server</p> <p>Check plugin status:</p> <pre><code>kubectl get plugin essentialsx --namespace minecraft --output yaml\n</code></pre> <p>Common causes:</p> Selector MismatchCompatibility IssueUpdate Not Applied Yet <p>Plugin doesn't match server labels.</p> <p>Check:</p> <pre><code># Plugin selector\nkubectl get plugin essentialsx --namespace minecraft \\\n  --output jsonpath='{.spec.instanceSelector}'\n\n# Server labels\nkubectl get papermcserver survival --namespace minecraft \\\n  --output jsonpath='{.metadata.labels}'\n</code></pre> <p>Solution: Fix labels or selector to match.</p> <p>Plugin incompatible with server version.</p> <p>Check:</p> <pre><code>kubectl get plugin essentialsx --namespace minecraft \\\n  --output jsonpath='{.status.matchedInstances}'\n</code></pre> <p>Solution: Use compatibility override or downgrade server:</p> <pre><code>spec:\n  compatibilityOverride:\n    enabled: true\n    minecraftVersions:\n      - \"1.21.1\"\n      - \"1.21.4\"\n</code></pre> <p>Updates only apply during maintenance windows.</p> <p>Check:</p> <pre><code>kubectl get papermcserver survival --namespace minecraft \\\n  --output jsonpath='{.spec.updateSchedule}'\n</code></pre> <p>Solution: Wait for maintenance window or force restart:</p> <pre><code>kubectl delete pod survival-0 --namespace minecraft\n</code></pre>"},{"location":"operations/troubleshooting/#plugin-download-failed","title":"Plugin Download Failed","text":"<p>Symptoms: Plugin status shows errors</p> <p>Check conditions:</p> <pre><code>kubectl get plugin bluemap --namespace minecraft \\\n  --output jsonpath='{.status.conditions}'\n</code></pre> <p>Common causes:</p> Repository UnavailableNetwork Issues <pre><code>status:\n  repositoryStatus: unavailable\n</code></pre> <p>Solution: Wait for Hangar to recover. Cached versions are used.</p> <p>Operator cannot reach Hangar API.</p> <p>Check operator logs:</p> <pre><code>kubectl logs deployment/minecraft-operator \\\n  --namespace minecraft-operator-system | grep -i hangar\n</code></pre> <p>Solution: Check network policies and egress rules.</p>"},{"location":"operations/troubleshooting/#update-issues","title":"Update Issues","text":""},{"location":"operations/troubleshooting/#updates-blocked","title":"Updates Blocked","text":"<p>Symptoms: <code>updateBlocked: true</code> in server status</p> <p>Check reason:</p> <pre><code>kubectl get papermcserver survival --namespace minecraft \\\n  --output jsonpath='{.status.updateBlocked}'\n</code></pre> <p>Common causes:</p> Plugin IncompatibilityNo Compatible Version <pre><code>updateBlocked:\n  blocked: true\n  reason: \"Plugin incompatible with target version\"\n  blockedBy:\n    plugin: \"old-plugin\"\n    supportedVersions: [\"1.20.4\"]\n</code></pre> <p>Solution:</p> <ol> <li>Wait for plugin update</li> <li>Use compatibility override</li> <li>Remove incompatible plugin</li> </ol> <p>All plugins together have no common compatible version.</p> <p>Solution: Review plugin combinations and consider removing one.</p>"},{"location":"operations/troubleshooting/#updates-not-happening","title":"Updates Not Happening","text":"<p>Symptoms: <code>availableUpdate</code> exists but not applied</p> <p>Check schedule:</p> <pre><code>kubectl get papermcserver survival --namespace minecraft \\\n  --output jsonpath='{.spec.updateSchedule}'\n</code></pre> <p>Common causes:</p> Outside Maintenance WindowUpdate Delay ActiveMaintenance Window Disabled <p>Updates only apply during scheduled windows.</p> <p>Check current cron:</p> <pre><code>spec:\n  updateSchedule:\n    maintenanceWindow:\n      enabled: true\n      cron: \"0 4 * * 0\"  # Sunday 4am only\n</code></pre> <p><code>updateDelay</code> prevents immediate updates.</p> <p>Check delay:</p> <pre><code>kubectl get papermcserver survival --namespace minecraft \\\n  --output jsonpath='{.spec.updateDelay}'\n</code></pre> <pre><code>spec:\n  updateSchedule:\n    maintenanceWindow:\n      enabled: false  # Updates disabled!\n</code></pre>"},{"location":"operations/troubleshooting/#operator-issues","title":"Operator Issues","text":""},{"location":"operations/troubleshooting/#operator-not-running","title":"Operator Not Running","text":"<p>Check deployment:</p> <pre><code>kubectl get deployment minecraft-operator \\\n  --namespace minecraft-operator-system\n</code></pre> <p>Check pod status:</p> <pre><code>kubectl describe pod -l app=minecraft-operator \\\n  --namespace minecraft-operator-system\n</code></pre>"},{"location":"operations/troubleshooting/#operator-errors","title":"Operator Errors","text":"<p>Check logs:</p> <pre><code>kubectl logs deployment/minecraft-operator \\\n  --namespace minecraft-operator-system \\\n  --tail=100\n</code></pre> <p>Common errors:</p> RBAC IssuesCRD Not Found <pre><code>cannot list resource \"papermcservers\" in API group \"mc.k8s.lex.la\"\n</code></pre> <p>Solution: Reinstall or check RBAC:</p> <pre><code>kubectl get clusterrole minecraft-operator-manager-role --output yaml\n</code></pre> <pre><code>no matches for kind \"PaperMCServer\" in version \"mc.k8s.lex.la/v1beta1\"\n</code></pre> <p>Solution: CRDs are embedded in the operator and applied at startup. Check that <code>crds.manage</code> is <code>true</code> in Helm values (default), or apply CRDs manually:</p> <pre><code>kubectl apply --server-side --filename internal/crdmanager/crds/\n</code></pre>"},{"location":"operations/troubleshooting/#getting-help","title":"Getting Help","text":"<p>If you can't resolve an issue:</p> <ol> <li>Check existing issues: GitHub Issues</li> <li>Create a new issue with:</li> <li>Operator version</li> <li>Kubernetes version</li> <li>Resource YAML (sanitized)</li> <li>Operator logs</li> <li>Pod events (<code>kubectl describe pod</code>)</li> </ol>"},{"location":"operations/troubleshooting/#see-also","title":"See Also","text":"<ul> <li>Operations \u2014 Common operational tasks</li> <li>Configuration \u2014 CRD reference</li> <li>Architecture \u2014 How the operator works</li> </ul>"},{"location":"reference/","title":"Reference","text":"<p>Reference documentation for Minecraft Operator.</p>"},{"location":"reference/#sections","title":"Sections","text":"<ul> <li> <p>:material-helm:{ .lg .middle } Helm Chart</p> <p>Helm chart values and configuration</p> <p> Helm Chart</p> </li> </ul>"},{"location":"reference/#api-reference","title":"API Reference","text":""},{"location":"reference/#api-group","title":"API Group","text":"<pre><code>mc.k8s.lex.la/v1beta1\n</code></pre>"},{"location":"reference/#resources","title":"Resources","text":"Kind Namespaced Description PaperMCServer Yes Minecraft server instance Plugin Yes Plugin for matched servers"},{"location":"reference/#versions","title":"Versions","text":"Version Status v1beta1 Current v1alpha1 Removed"},{"location":"reference/#container-images","title":"Container Images","text":""},{"location":"reference/#operator","title":"Operator","text":"<pre><code>ghcr.io/lexfrei/minecraft-operator:latest\n</code></pre> <p>Available tags:</p> <ul> <li><code>latest</code> \u2014 Latest stable release</li> <li><code>v1.0.0</code> \u2014 Specific version</li> <li><code>v1.0</code> \u2014 Minor version track</li> <li><code>v1</code> \u2014 Major version track</li> </ul>"},{"location":"reference/#paper-server","title":"Paper Server","text":"<pre><code>lexfrei/papermc:1.21.4-125\n</code></pre> <p>Format: <code>lexfrei/papermc:{version}-{build}</code></p>"},{"location":"reference/#helm-chart","title":"Helm Chart","text":"<pre><code>oci://ghcr.io/lexfrei/minecraft-operator\n</code></pre> <p>CRDs are embedded in the operator binary and applied at startup via server-side apply. There is no separate CRD chart.</p>"},{"location":"reference/#external-links","title":"External Links","text":"Resource URL GitHub Repository lexfrei/minecraft-operator Issues GitHub Issues Releases GitHub Releases Hangar API hangar.papermc.io Paper Downloads papermc.io"},{"location":"reference/#see-also","title":"See Also","text":"<ul> <li>Configuration \u2014 CRD reference</li> <li>Architecture \u2014 System design</li> </ul>"},{"location":"reference/helm-chart/","title":"Helm Chart Reference","text":"<p>Reference for Minecraft Operator Helm chart values.</p>"},{"location":"reference/helm-chart/#installation","title":"Installation","text":"<pre><code># Single step \u2014 CRDs are embedded and applied at startup via server-side apply\nhelm install minecraft-operator \\\n  oci://ghcr.io/lexfrei/minecraft-operator \\\n  --namespace minecraft-operator-system \\\n  --create-namespace\n</code></pre>"},{"location":"reference/helm-chart/#values","title":"Values","text":""},{"location":"reference/helm-chart/#crds","title":"CRDs","text":"Value Description Default <code>crds.manage</code> Operator manages CRDs at startup via server-side apply <code>true</code>"},{"location":"reference/helm-chart/#image","title":"Image","text":"Value Description Default <code>image.repository</code> Container image <code>ghcr.io/lexfrei/minecraft-operator</code> <code>image.pullPolicy</code> Pull policy <code>IfNotPresent</code> <code>image.tag</code> Image tag Chart appVersion <code>imagePullSecrets</code> Image pull secrets <code>[]</code>"},{"location":"reference/helm-chart/#deployment","title":"Deployment","text":"Value Description Default <code>replicaCount</code> Number of replicas <code>1</code> <code>nameOverride</code> Override chart name <code>\"\"</code> <code>fullnameOverride</code> Override full name <code>\"\"</code>"},{"location":"reference/helm-chart/#service-account","title":"Service Account","text":"Value Description Default <code>serviceAccount.create</code> Create service account <code>true</code> <code>serviceAccount.automountServiceAccountToken</code> Automount API credentials <code>true</code> <code>serviceAccount.annotations</code> SA annotations <code>{}</code> <code>serviceAccount.name</code> SA name override <code>\"\"</code>"},{"location":"reference/helm-chart/#pod-configuration","title":"Pod Configuration","text":"Value Description Default <code>podAnnotations</code> Pod annotations <code>{}</code> <code>podLabels</code> Pod labels <code>{}</code>"},{"location":"reference/helm-chart/#security-context","title":"Security Context","text":"Value Description Default <code>podSecurityContext.runAsNonRoot</code> Run as non-root <code>true</code> <code>podSecurityContext.runAsUser</code> User ID <code>65534</code> <code>podSecurityContext.seccompProfile.type</code> Seccomp profile <code>RuntimeDefault</code> <code>securityContext.allowPrivilegeEscalation</code> Privilege escalation <code>false</code> <code>securityContext.capabilities.drop</code> Dropped capabilities <code>[\"ALL\"]</code> <code>securityContext.readOnlyRootFilesystem</code> Read-only filesystem <code>true</code>"},{"location":"reference/helm-chart/#resources","title":"Resources","text":"Value Description Default <code>resources.limits.cpu</code> CPU limit <code>500m</code> <code>resources.limits.memory</code> Memory limit <code>512Mi</code> <code>resources.requests.cpu</code> CPU request <code>100m</code> <code>resources.requests.memory</code> Memory request <code>128Mi</code>"},{"location":"reference/helm-chart/#leader-election","title":"Leader Election","text":"Value Description Default <code>leaderElection.enabled</code> Enable leader election <code>true</code>"},{"location":"reference/helm-chart/#metrics","title":"Metrics","text":"Value Description Default <code>metrics.enabled</code> Enable metrics <code>true</code> <code>metrics.port</code> Metrics port <code>8080</code> <code>metrics.serviceMonitor.enabled</code> Create ServiceMonitor for Prometheus Operator <code>false</code> <code>metrics.serviceMonitor.interval</code> Scrape interval (e.g., <code>30s</code>) <code>\"\"</code> <code>metrics.serviceMonitor.scrapeTimeout</code> Scrape timeout (e.g., <code>10s</code>) <code>\"\"</code> <code>metrics.serviceMonitor.labels</code> Additional labels for ServiceMonitor <code>{}</code> <code>metrics.serviceMonitor.endpointAuth</code> Endpoint auth config (e.g., <code>authorization</code> or <code>bearerTokenFile</code>) <code>{}</code>"},{"location":"reference/helm-chart/#health-probes","title":"Health Probes","text":"Value Description Default <code>health.port</code> Health probe port <code>8081</code>"},{"location":"reference/helm-chart/#web-ui","title":"Web UI","text":"Value Description Default <code>webui.enabled</code> Enable Web UI <code>true</code> <code>webui.port</code> Web UI port <code>8082</code> <code>webui.namespace</code> Namespace to watch <code>\"\"</code> (all) <code>webui.service.type</code> Service type <code>ClusterIP</code> <code>webui.service.port</code> Service port <code>8082</code>"},{"location":"reference/helm-chart/#web-ui-ingress","title":"Web UI Ingress","text":"Value Description Default <code>webui.ingress.enabled</code> Enable Ingress <code>false</code> <code>webui.ingress.className</code> Ingress class <code>\"\"</code> <code>webui.ingress.annotations</code> Ingress annotations <code>{}</code> <code>webui.ingress.hosts</code> Ingress hosts See below <code>webui.ingress.tls</code> TLS configuration <code>[]</code>"},{"location":"reference/helm-chart/#web-ui-httproute-gateway-api","title":"Web UI HTTPRoute (Gateway API)","text":"Value Description Default <code>webui.httproute.enabled</code> Enable HTTPRoute <code>false</code> <code>webui.httproute.annotations</code> HTTPRoute annotations <code>{}</code>"},{"location":"reference/helm-chart/#examples","title":"Examples","text":""},{"location":"reference/helm-chart/#minimal-installation","title":"Minimal Installation","text":"<pre><code># values.yaml\nreplicaCount: 1\n</code></pre>"},{"location":"reference/helm-chart/#production-configuration","title":"Production Configuration","text":"<pre><code># values.yaml\nreplicaCount: 1\n\nresources:\n  limits:\n    cpu: 1\n    memory: 1Gi\n  requests:\n    cpu: 200m\n    memory: 256Mi\n\nleaderElection:\n  enabled: true\n\nwebui:\n  enabled: true\n  ingress:\n    enabled: true\n    className: nginx\n    annotations:\n      cert-manager.io/cluster-issuer: letsencrypt-prod\n    hosts:\n      - host: minecraft-operator.example.com\n        paths:\n          - path: /\n            pathType: Prefix\n    tls:\n      - secretName: minecraft-operator-tls\n        hosts:\n          - minecraft-operator.example.com\n</code></pre>"},{"location":"reference/helm-chart/#web-ui-with-gateway-api","title":"Web UI with Gateway API","text":"<pre><code># values.yaml\nwebui:\n  enabled: true\n  httproute:\n    enabled: true\n    annotations:\n      external-dns.alpha.kubernetes.io/hostname: minecraft-operator.example.com\n</code></pre>"},{"location":"reference/helm-chart/#disable-crd-management","title":"Disable CRD Management","text":"<pre><code># values.yaml\ncrds:\n  manage: false  # Operator will NOT apply CRDs at startup (manage them externally)\n</code></pre> <p>When <code>crds.manage</code> is <code>false</code>, you must apply CRDs manually before starting the operator:</p> <pre><code>kubectl apply --server-side --filename internal/crdmanager/crds/\n</code></pre>"},{"location":"reference/helm-chart/#see-also","title":"See Also","text":"<ul> <li>Installation \u2014 Installation guide</li> <li>Configuration \u2014 CRD configuration</li> </ul>"}]}