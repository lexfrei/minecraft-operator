# Default values for minecraft-operator.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# CRDs management
crds:
  # -- Operator manages CRDs at startup via server-side apply.
  # Set to false to disable CRD management (e.g. if CRDs are managed externally).
  manage: true

# Operator configuration
replicaCount: 1

image:
  repository: ghcr.io/lexfrei/minecraft-operator
  pullPolicy: IfNotPresent
  # -- Overrides the image tag whose default is the chart appVersion
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  # -- Specifies whether a service account should be created
  create: true
  # -- Automatically mount a ServiceAccount's API credentials
  automountServiceAccountToken: true
  # -- Annotations to add to the service account
  annotations: {}
  # -- The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template.
  name: ""

podAnnotations: {}
podLabels: {}

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 65534
  seccompProfile:
    type: RuntimeDefault

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: true

resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 128Mi

# Leader election configuration
leaderElection:
  enabled: true

# Metrics configuration
metrics:
  enabled: true
  port: 8080
  serviceMonitor:
    # -- Enable ServiceMonitor for Prometheus Operator auto-discovery
    enabled: false
    # -- Scrape interval (e.g., "30s"). Uses Prometheus default if empty
    interval: ""
    # -- Scrape timeout (e.g., "10s"). Uses Prometheus default if empty
    scrapeTimeout: ""
    # -- Additional labels for ServiceMonitor (e.g., for Prometheus selector matching)
    labels: {}
    # -- Endpoint authentication configuration.
    # Configure based on your Prometheus Operator version:
    #
    # Modern (Prometheus Operator >= 0.52):
    #   endpointAuth:
    #     authorization:
    #       credentials:
    #         name: prometheus-token-secret
    #         key: token
    #
    # Legacy (still functional but deprecated):
    #   endpointAuth:
    #     bearerTokenFile: /var/run/secrets/kubernetes.io/serviceaccount/token
    endpointAuth: {}

# Health probe configuration
health:
  port: 8081

# Web UI configuration
webui:
  enabled: true
  port: 8082
  namespace: ""  # If empty, uses the operator's namespace
  service:
    type: ClusterIP
    port: 8082
  ingress:
    enabled: false
    className: ""
    annotations: {}
      # cert-manager.io/cluster-issuer: letsencrypt-prod
      # nginx.ingress.kubernetes.io/auth-url: "https://$host/oauth2/auth"
      # nginx.ingress.kubernetes.io/auth-signin: "https://$host/oauth2/start?rd=$escaped_request_uri"
    hosts:
      - host: minecraft-operator.local
        paths:
          - path: /
            pathType: Prefix
    tls: []
    #  - secretName: minecraft-operator-tls
    #    hosts:
    #      - minecraft-operator.local
  # Gateway API HTTPRoute configuration
  # Requires Gateway API CRDs to be installed in the cluster
  # Can be enabled alongside Ingress for different use cases
  httproute:
    enabled: false
    annotations: {}
    # Reference to the Gateway(s) that this HTTPRoute should attach to
    parentRefs:
      - name: gateway
        namespace: gateway-system
    # Hostnames to match for routing
    hostnames:
      - minecraft-operator.local
    # Custom rules (optional) - if not specified, defaults to routing all traffic on /
    # rules:
    #   - matches:
    #       - path:
    #           type: PathPrefix
    #           value: /
    #     backendRefs:
    #       - name: minecraft-operator-webui
    #         port: 8082

# Admission webhook configuration
webhook:
  # -- Enable validating admission webhooks for Plugin and PaperMCServer CRDs.
  # Validates semantic rules (strategy/field consistency, cron syntax, etc.) at admission time.
  enabled: false
  # -- Failure policy for webhooks. "Fail" rejects invalid resources, "Ignore" allows them through.
  # Use "Fail" in production, "Ignore" during initial rollout or debugging.
  failurePolicy: Fail
  # -- Base64-encoded CA bundle for webhook TLS verification.
  # Required when certManager.enabled is false. The API server uses this CA to verify
  # the webhook's TLS certificate. You can generate one with:
  #   openssl req -x509 -newkey rsa:4096 -keyout tls.key -out tls.crt -days 365 -nodes -subj '/CN=webhook'
  #   kubectl create secret tls <release>-webhook-cert --cert=tls.crt --key=tls.key -n <namespace>
  #   caBundle: $(base64 < tls.crt)
  caBundle: ""
  # -- cert-manager integration for webhook TLS certificates.
  certManager:
    # -- Enable cert-manager Certificate resource for webhook TLS.
    # If false, the operator generates self-signed certificates at startup.
    enabled: false
    issuerRef:
      # -- Issuer kind (Issuer or ClusterIssuer).
      kind: ClusterIssuer
      # -- Issuer name.
      name: selfsigned-issuer

# Network policy configuration
networkPolicy:
  # -- Enable NetworkPolicy for the operator pod.
  # Restricts ingress to metrics/health/webui ports and egress to DNS + Kubernetes API.
  # Requires a CNI that supports NetworkPolicy (Calico, Cilium, etc.).
  enabled: false
  # -- RCON port for egress rules to managed Minecraft server pods.
  # Change this if your servers use a non-default RCON port.
  rconPort: 25575

# Node labels for pod assignment
nodeSelector: {}

# Tolerations for pod assignment
tolerations: []

# Affinity for pod assignment
affinity: {}
